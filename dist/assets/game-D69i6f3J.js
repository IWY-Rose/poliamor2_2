/* empty css             */import{W as me,P as Se,S as I,C as S,T as Ke,a as re,b as Ee,L as ke,c as oe,F as J,M as F,V as Re,d as We,e as X,D as Pe,f as V,g as y,I as Ye,Q as D,O as De,h as Ie,i as Xe,B as j,j as qe,k as Oe,N as Je,l as Qe,m as Ze,n as Fe,o as et,R as ae,p as tt,q as it,r as st,s as Z,t as nt,u as Ne,v as rt,w as U,x as ot,y as Be,z as at,A as le,E as lt,G as ht,H as ct,J as dt,K as ee,U as he,X as q,Y as ut,Z as pt,_ as ft,$ as He,a0 as mt,a1 as gt,a2 as yt,a3 as ge,a4 as At,a5 as ye,a6 as wt,a7 as bt,a8 as xt,a9 as H,aa as vt,ab as Tt,ac as _t,ad as Ge,ae as Mt,af as Lt,ag as Ct,ah as St,ai as Ae,aj as we,ak as be,al as Q,am as Et}from"./three-BtSkMtSD.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class kt{constructor(){const e=document.querySelector("#gameCanvas");if(!e)throw new Error("Canvas element not found!");try{new me().dispose()}catch(t){const i=document.createElement("div");throw i.textContent="WebGL not supported: "+t.message,document.body.appendChild(i),t}this.renderer=new me({canvas:e,antialias:!0,powerPreference:"high-performance",logarithmicDepthBuffer:!0,shadowMapEnabled:!0}),this.renderer.autoClear=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Se,this.renderer.outputColorSpace=I,this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setClearColor(new S(8900331),1),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight)}get instance(){return this.renderer}}function xe(u,e){if(e===Ke)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),u;if(e===re||e===Ee){let t=u.getIndex();if(t===null){const n=[],o=u.getAttribute("position");if(o!==void 0){for(let a=0;a<o.count;a++)n.push(a);u.setIndex(n),t=u.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),u}const i=t.count-2,s=[];if(e===re)for(let n=1;n<=i;n++)s.push(t.getX(0)),s.push(t.getX(n)),s.push(t.getX(n+1));else for(let n=0;n<i;n++)n%2===0?(s.push(t.getX(n)),s.push(t.getX(n+1)),s.push(t.getX(n+2))):(s.push(t.getX(n+2)),s.push(t.getX(n+1)),s.push(t.getX(n)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=u.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),u}class Rt extends ke{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ft(t)}),this.register(function(t){return new Ut(t)}),this.register(function(t){return new jt(t)}),this.register(function(t){return new Vt(t)}),this.register(function(t){return new Bt(t)}),this.register(function(t){return new Ht(t)}),this.register(function(t){return new Gt(t)}),this.register(function(t){return new zt(t)}),this.register(function(t){return new Ot(t)}),this.register(function(t){return new $t(t)}),this.register(function(t){return new Nt(t)}),this.register(function(t){return new Dt(t)}),this.register(function(t){return new Kt(t)}),this.register(function(t){return new Wt(t)})}load(e,t,i,s){const r=this;let n;this.resourcePath!==""?n=this.resourcePath:this.path!==""?n=this.path:n=oe.extractUrlBase(e),this.manager.itemStart(e);const o=function(h){s?s(h):console.error(h),r.manager.itemError(e),r.manager.itemEnd(e)},a=new J(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(h){try{r.parse(h,n,function(l){t(l),r.manager.itemEnd(e)},o)}catch(l){o(l)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const n={},o={},a=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===ze){try{n[w.KHR_BINARY_GLTF]=new Yt(e)}catch(c){s&&s(c);return}r=JSON.parse(n[w.KHR_BINARY_GLTF].content)}else r=JSON.parse(a.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new ai(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const c=this.pluginCallbacks[l](h);o[c.name]=c,n[c.name]=!0}if(r.extensionsUsed)for(let l=0;l<r.extensionsUsed.length;++l){const c=r.extensionsUsed[l],d=r.extensionsRequired||[];switch(c){case w.KHR_MATERIALS_UNLIT:n[c]=new It;break;case w.KHR_DRACO_MESH_COMPRESSION:n[c]=new Xt(r,this.dracoLoader);break;case w.KHR_TEXTURE_TRANSFORM:n[c]=new qt;break;case w.KHR_MESH_QUANTIZATION:n[c]=new Jt;break;default:d.indexOf(c)>=0&&o[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}h.setExtensions(n),h.setPlugins(o),h.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}}function Pt(){let u={};return{get:function(e){return u[e]},add:function(e,t){u[e]=t},remove:function(e){delete u[e]},removeAll:function(){u={}}}}const w={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Dt{constructor(e){this.parser=e,this.name=w.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,a=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let h;const l=new S(16777215);a.color!==void 0&&l.fromArray(a.color);const c=a.range!==void 0?a.range:0;switch(a.type){case"directional":h=new Pe(l),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new X(l),h.distance=c;break;case"spot":h=new We(l),h.distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,h.angle=a.spot.outerConeAngle,h.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return h.position.set(0,0,0),h.decay=2,P(h,a),a.intensity!==void 0&&(h.intensity=a.intensity),h.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(h),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return i._getNodeRef(t.cache,o,a)})}}class It{constructor(){this.name=w.KHR_MATERIALS_UNLIT}getMaterialType(){return U}extendParams(e,t,i){const s=[];e.color=new S(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const n=r.baseColorFactor;e.color.fromArray(n),e.opacity=n[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,I))}return Promise.all(s)}}class Ot{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class Ft{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:F}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],n=s.extensions[this.name];if(n.clearcoatFactor!==void 0&&(t.clearcoat=n.clearcoatFactor),n.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),n.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),n.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),n.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),n.clearcoatNormalTexture.scale!==void 0)){const o=n.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Re(o,o)}return Promise.all(r)}}class Nt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:F}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],n=s.extensions[this.name];return n.iridescenceFactor!==void 0&&(t.iridescence=n.iridescenceFactor),n.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",n.iridescenceTexture)),n.iridescenceIor!==void 0&&(t.iridescenceIOR=n.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),n.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=n.iridescenceThicknessMinimum),n.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=n.iridescenceThicknessMaximum),n.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",n.iridescenceThicknessTexture)),Promise.all(r)}}class Bt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:F}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new S(0,0,0),t.sheenRoughness=0,t.sheen=1;const n=s.extensions[this.name];return n.sheenColorFactor!==void 0&&t.sheenColor.fromArray(n.sheenColorFactor),n.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=n.sheenRoughnessFactor),n.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",n.sheenColorTexture,I)),n.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(r)}}class Ht{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:F}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],n=s.extensions[this.name];return n.transmissionFactor!==void 0&&(t.transmission=n.transmissionFactor),n.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",n.transmissionTexture)),Promise.all(r)}}class Gt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:F}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],n=s.extensions[this.name];t.thickness=n.thicknessFactor!==void 0?n.thicknessFactor:0,n.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",n.thicknessTexture)),t.attenuationDistance=n.attenuationDistance||1/0;const o=n.attenuationColor||[1,1,1];return t.attenuationColor=new S(o[0],o[1],o[2]),Promise.all(r)}}class zt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:F}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class $t{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:F}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],n=s.extensions[this.name];t.specularIntensity=n.specularFactor!==void 0?n.specularFactor:1,n.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",n.specularTexture));const o=n.specularColorFactor||[1,1,1];return t.specularColor=new S(o[0],o[1],o[2]),n.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",n.specularColorTexture,I)),Promise.all(r)}}class Ut{constructor(e){this.parser=e,this.name=w.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],n=t.options.ktx2Loader;if(!n){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,n)}}class jt{constructor(e){this.parser=e,this.name=w.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const n=r.extensions[t],o=s.images[n.source];let a=i.textureLoader;if(o.uri){const h=i.options.manager.getHandler(o.uri);h!==null&&(a=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,n.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Vt{constructor(e){this.parser=e,this.name=w.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const n=r.extensions[t],o=s.images[n.source];let a=i.textureLoader;if(o.uri){const h=i.options.manager.getHandler(o.uri);h!==null&&(a=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,n.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Kt{constructor(e){this.name=w.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(o){const a=s.byteOffset||0,h=s.byteLength||0,l=s.count,c=s.byteStride,d=new Uint8Array(o,a,h);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(l,c,d,s.mode,s.filter).then(function(p){return p.buffer}):n.ready.then(function(){const p=new ArrayBuffer(l*c);return n.decodeGltfBuffer(new Uint8Array(p),l,c,d,s.mode,s.filter),p})})}else return null}}class Wt{constructor(e){this.name=w.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const h of s.primitives)if(h.mode!==_.TRIANGLES&&h.mode!==_.TRIANGLE_STRIP&&h.mode!==_.TRIANGLE_FAN&&h.mode!==void 0)return null;const n=i.extensions[this.name].attributes,o=[],a={};for(const h in n)o.push(this.parser.getDependency("accessor",n[h]).then(l=>(a[h]=l,a[h])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(h=>{const l=h.pop(),c=l.isGroup?l.children:[l],d=h[0].count,p=[];for(const g of c){const A=new V,f=new y,m=new D,x=new y(1,1,1),b=new Ye(g.geometry,g.material,d);for(let v=0;v<d;v++)a.TRANSLATION&&f.fromBufferAttribute(a.TRANSLATION,v),a.ROTATION&&m.fromBufferAttribute(a.ROTATION,v),a.SCALE&&x.fromBufferAttribute(a.SCALE,v),b.setMatrixAt(v,A.compose(f,m,x));for(const v in a)v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&g.geometry.setAttribute(v,a[v]);De.prototype.copy.call(b,g),this.parser.assignFinalMaterial(b),p.push(b)}return l.isGroup?(l.clear(),l.add(...p),l):p[0]}))}}const ze="glTF",z=12,ve={JSON:1313821514,BIN:5130562};class Yt{constructor(e){this.name=w.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,z),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ze)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-z,r=new DataView(e,z);let n=0;for(;n<s;){const o=r.getUint32(n,!0);n+=4;const a=r.getUint32(n,!0);if(n+=4,a===ve.JSON){const h=new Uint8Array(e,z+n,o);this.content=i.decode(h)}else if(a===ve.BIN){const h=z+n;this.body=e.slice(h,h+o)}n+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Xt{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=w.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,o={},a={},h={};for(const l in n){const c=ce[l]||l.toLowerCase();o[c]=n[l]}for(const l in e.attributes){const c=ce[l]||l.toLowerCase();if(n[l]!==void 0){const d=i.accessors[e.attributes[l]],p=G[d.componentType];h[c]=p.name,a[c]=d.normalized===!0}}return t.getDependency("bufferView",r).then(function(l){return new Promise(function(c){s.decodeDracoFile(l,function(d){for(const p in d.attributes){const g=d.attributes[p],A=a[p];A!==void 0&&(g.normalized=A)}c(d)},o,h)})})}}class qt{constructor(){this.name=w.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Jt{constructor(){this.name=w.KHR_MESH_QUANTIZATION}}class $e extends xt{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let n=0;n!==s;n++)t[n]=i[r+n];return t}interpolate_(e,t,i,s){const r=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=o*2,h=o*3,l=s-t,c=(i-t)/l,d=c*c,p=d*c,g=e*h,A=g-h,f=-2*p+3*d,m=p-d,x=1-f,b=m-d+c;for(let v=0;v!==o;v++){const O=n[A+v+o],M=n[A+v+a]*l,T=n[g+v+o],E=n[g+v]*l;r[v]=x*O+b*M+f*T+m*E}return r}}const Qt=new D;class Zt extends $e{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return Qt.fromArray(r).normalize().toArray(r),r}}const _={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},G={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Te={9728:et,9729:Fe,9984:Ze,9985:Qe,9986:Je,9987:Oe},_e={33071:it,33648:tt,10497:ae},te={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ce={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ei={CUBICSPLINE:void 0,LINEAR:He,STEP:ft},ie={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ti(u){return u.DefaultMaterial===void 0&&(u.DefaultMaterial=new Ne({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:bt})),u.DefaultMaterial}function $(u,e,t){for(const i in t.extensions)u[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function P(u,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(u.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ii(u,e,t){let i=!1,s=!1,r=!1;for(let h=0,l=e.length;h<l;h++){const c=e[h];if(c.POSITION!==void 0&&(i=!0),c.NORMAL!==void 0&&(s=!0),c.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(u);const n=[],o=[],a=[];for(let h=0,l=e.length;h<l;h++){const c=e[h];if(i){const d=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):u.attributes.position;n.push(d)}if(s){const d=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):u.attributes.normal;o.push(d)}if(r){const d=c.COLOR_0!==void 0?t.getDependency("accessor",c.COLOR_0):u.attributes.color;a.push(d)}}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(a)]).then(function(h){const l=h[0],c=h[1],d=h[2];return i&&(u.morphAttributes.position=l),s&&(u.morphAttributes.normal=c),r&&(u.morphAttributes.color=d),u.morphTargetsRelative=!0,u})}function si(u,e){if(u.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)u.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(u.morphTargetInfluences.length===t.length){u.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)u.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ni(u){const e=u.extensions&&u.extensions[w.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Me(e.attributes):t=u.indices+":"+Me(u.attributes)+":"+u.mode,t}function Me(u){let e="";const t=Object.keys(u).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+u[t[i]]+";";return e}function de(u){switch(u){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function ri(u){return u.search(/\.jpe?g($|\?)/i)>0||u.search(/^data\:image\/jpeg/)===0?"image/jpeg":u.search(/\.webp($|\?)/i)>0||u.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const oi=new V;class ai{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Pt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&r<98?this.textureLoader=new Ie(this.options.manager):this.textureLoader=new Xe(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new J(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(n){return n._markDefs&&n._markDefs()}),Promise.all(this._invokeAll(function(n){return n.beforeRoot&&n.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(n){const o={scene:n[0][s.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:s.asset,parser:i,userData:{}};$(r,o,s),P(o,s),Promise.all(i._invokeAll(function(a){return a.afterRoot&&a.afterRoot(o)})).then(function(){e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const n=t[s].joints;for(let o=0,a=n.length;o<a;o++)e[n[o]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const n=e[s];n.mesh!==void 0&&(this._addNodeRef(this.meshCache,n.mesh),n.skin!==void 0&&(i[n.mesh].isSkinnedMesh=!0)),n.camera!==void 0&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),r=(n,o)=>{const a=this.associations.get(n);a!=null&&this.associations.set(o,a);for(const[h,l]of n.children.entries())r(l,o.children[h])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,n){return i.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[w.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,n){i.load(oe.resolveURL(t.uri,s.path),r,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const n=te[s.type],o=G[s.componentType],a=s.normalized===!0,h=new o(s.count*n);return Promise.resolve(new j(h,n,a))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(n){const o=n[0],a=te[s.type],h=G[s.componentType],l=h.BYTES_PER_ELEMENT,c=l*a,d=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let A,f;if(p&&p!==c){const m=Math.floor(d/p),x="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+m+":"+s.count;let b=t.cache.get(x);b||(A=new h(o,m*p,s.count*p/l),b=new qe(A,p/l),t.cache.add(x,b)),f=new yt(b,a,d%p/l,g)}else o===null?A=new h(s.count*a):A=new h(o,d,s.count*a),f=new j(A,a,g);if(s.sparse!==void 0){const m=te.SCALAR,x=G[s.sparse.indices.componentType],b=s.sparse.indices.byteOffset||0,v=s.sparse.values.byteOffset||0,O=new x(n[1],b,s.sparse.count*m),M=new h(n[2],v,s.sparse.count*a);o!==null&&(f=new j(f.array.slice(),f.itemSize,f.normalized));for(let T=0,E=O.length;T<E;T++){const N=O[T];if(f.setX(N,M[T*a]),a>=2&&f.setY(N,M[T*a+1]),a>=3&&f.setZ(N,M[T*a+2]),a>=4&&f.setW(N,M[T*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,n=t.images[r];let o=this.textureLoader;if(n.uri){const a=i.manager.getHandler(n.uri);a!==null&&(o=a)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,i){const s=this,r=this.json,n=r.textures[e],o=r.images[t],a=(o.uri||o.bufferView)+":"+n.sampler;if(this.textureCache[a])return this.textureCache[a];const h=this.loadImageSource(t,i).then(function(l){l.flipY=!1,l.name=n.name||o.name||"",l.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(l.name=o.uri);const d=(r.samplers||{})[n.sampler]||{};return l.magFilter=Te[d.magFilter]||Fe,l.minFilter=Te[d.minFilter]||Oe,l.wrapS=_e[d.wrapS]||ae,l.wrapT=_e[d.wrapT]||ae,s.associations.set(l,{textures:e}),l}).catch(function(){return null});return this.textureCache[a]=h,h}loadImageSource(e,t){const i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(c=>c.clone());const n=s.images[e],o=self.URL||self.webkitURL;let a=n.uri||"",h=!1;if(n.bufferView!==void 0)a=i.getDependency("bufferView",n.bufferView).then(function(c){h=!0;const d=new Blob([c],{type:n.mimeType});return a=o.createObjectURL(d),a});else if(n.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then(function(c){return new Promise(function(d,p){let g=d;t.isImageBitmapLoader===!0&&(g=function(A){const f=new ge(A);f.needsUpdate=!0,d(f)}),t.load(oe.resolveURL(c,r.path),g,void 0,p)})}).then(function(c){return h===!0&&o.revokeObjectURL(a),c.userData.mimeType=n.mimeType||ri(n.uri),c}).catch(function(c){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),c});return this.sourceCache[e]=l,l}assignTexture(e,t,i,s){const r=this;return this.getDependency("texture",i.index).then(function(n){if(!n)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(n=n.clone(),n.channel=i.texCoord),r.extensions[w.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[w.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const a=r.associations.get(n);n=r.extensions[w.KHR_TEXTURE_TRANSFORM].extendTexture(n,o),r.associations.set(n,a)}}return s!==void 0&&(n.colorSpace=s),e[t]=n,n})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,n=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+i.uuid;let a=this.cache.get(o);a||(a=new st,Z.prototype.copy.call(a,i),a.color.copy(i.color),a.map=i.map,a.sizeAttenuation=!1,this.cache.add(o,a)),i=a}else if(e.isLine){const o="LineBasicMaterial:"+i.uuid;let a=this.cache.get(o);a||(a=new nt,Z.prototype.copy.call(a,i),a.color.copy(i.color),a.map=i.map,this.cache.add(o,a)),i=a}if(s||r||n){let o="ClonedMaterial:"+i.uuid+":";s&&(o+="derivative-tangents:"),r&&(o+="vertex-colors:"),n&&(o+="flat-shading:");let a=this.cache.get(o);a||(a=i.clone(),r&&(a.vertexColors=!0),n&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(o,a),this.associations.set(a,this.associations.get(i))),i=a}e.material=i}getMaterialType(){return Ne}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let n;const o={},a=r.extensions||{},h=[];if(a[w.KHR_MATERIALS_UNLIT]){const c=s[w.KHR_MATERIALS_UNLIT];n=c.getMaterialType(),h.push(c.extendParams(o,r,t))}else{const c=r.pbrMetallicRoughness||{};if(o.color=new S(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){const d=c.baseColorFactor;o.color.fromArray(d),o.opacity=d[3]}c.baseColorTexture!==void 0&&h.push(t.assignTexture(o,"map",c.baseColorTexture,I)),o.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,o.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture)),h.push(t.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture))),n=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,o)})))}r.doubleSided===!0&&(o.side=rt);const l=r.alphaMode||ie.OPAQUE;if(l===ie.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===ie.MASK&&(o.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&n!==U&&(h.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Re(1,1),r.normalTexture.scale!==void 0)){const c=r.normalTexture.scale;o.normalScale.set(c,c)}return r.occlusionTexture!==void 0&&n!==U&&(h.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&n!==U&&(o.emissive=new S().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&n!==U&&h.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,I)),Promise.all(h).then(function(){const c=new n(o);return r.name&&(c.name=r.name),P(c,r),t.associations.set(c,{materials:e}),r.extensions&&$(s,c,r),c})}createUniqueName(e){const t=ot.sanitizeNodeName(e||"");let i=t;for(let s=1;this.nodeNamesUsed[i];++s)i=t+"_"+s;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(o){return i[w.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(a){return Le(a,o,t)})}const n=[];for(let o=0,a=e.length;o<a;o++){const h=e[o],l=ni(h),c=s[l];if(c)n.push(c.promise);else{let d;h.extensions&&h.extensions[w.KHR_DRACO_MESH_COMPRESSION]?d=r(h):d=Le(new Be,h,t),s[l]={primitive:h,promise:d},n.push(d)}}return Promise.all(n)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],n=r.primitives,o=[];for(let a=0,h=n.length;a<h;a++){const l=n[a].material===void 0?ti(this.cache):this.getDependency("material",n[a].material);o.push(l)}return o.push(t.loadGeometries(n)),Promise.all(o).then(function(a){const h=a.slice(0,a.length-1),l=a[a.length-1],c=[];for(let p=0,g=l.length;p<g;p++){const A=l[p],f=n[p];let m;const x=h[p];if(f.mode===_.TRIANGLES||f.mode===_.TRIANGLE_STRIP||f.mode===_.TRIANGLE_FAN||f.mode===void 0)m=r.isSkinnedMesh===!0?new at(A,x):new le(A,x),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),f.mode===_.TRIANGLE_STRIP?m.geometry=xe(m.geometry,Ee):f.mode===_.TRIANGLE_FAN&&(m.geometry=xe(m.geometry,re));else if(f.mode===_.LINES)m=new lt(A,x);else if(f.mode===_.LINE_STRIP)m=new ht(A,x);else if(f.mode===_.LINE_LOOP)m=new ct(A,x);else if(f.mode===_.POINTS)m=new dt(A,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);Object.keys(m.geometry.morphAttributes).length>0&&si(m,r),m.name=t.createUniqueName(r.name||"mesh_"+e),P(m,r),f.extensions&&$(s,m,f),t.assignFinalMaterial(m),c.push(m)}for(let p=0,g=c.length;p<g;p++)t.associations.set(c[p],{meshes:e,primitives:p});if(c.length===1)return c[0];const d=new ee;t.associations.set(d,{meshes:e});for(let p=0,g=c.length;p<g;p++)d.add(c[p]);return d})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new he(q.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new ut(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),P(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,r=t.joints.length;s<r;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),n=s,o=[],a=[];for(let h=0,l=n.length;h<l;h++){const c=n[h];if(c){o.push(c);const d=new V;r!==null&&d.fromArray(r.array,h*16),a.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new pt(o,a)})}loadAnimation(e){const i=this.json.animations[e],s=i.name?i.name:"animation_"+e,r=[],n=[],o=[],a=[],h=[];for(let l=0,c=i.channels.length;l<c;l++){const d=i.channels[l],p=i.samplers[d.sampler],g=d.target,A=g.node,f=i.parameters!==void 0?i.parameters[p.input]:p.input,m=i.parameters!==void 0?i.parameters[p.output]:p.output;g.node!==void 0&&(r.push(this.getDependency("node",A)),n.push(this.getDependency("accessor",f)),o.push(this.getDependency("accessor",m)),a.push(p),h.push(g))}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(a),Promise.all(h)]).then(function(l){const c=l[0],d=l[1],p=l[2],g=l[3],A=l[4],f=[];for(let m=0,x=c.length;m<x;m++){const b=c[m],v=d[m],O=p[m],M=g[m],T=A[m];if(b===void 0)continue;b.updateMatrix();let E;switch(R[T.path]){case R.weights:E=wt;break;case R.rotation:E=ye;break;case R.position:case R.scale:default:E=At;break}const N=b.name?b.name:b.uuid,Ue=M.interpolation!==void 0?ei[M.interpolation]:He,W=[];R[T.path]===R.weights?b.traverse(function(L){L.morphTargetInfluences&&W.push(L.name?L.name:L.uuid)}):W.push(N);let B=O.array;if(O.normalized){const L=de(B.constructor),Y=new Float32Array(B.length);for(let k=0,fe=B.length;k<fe;k++)Y[k]=B[k]*L;B=Y}for(let L=0,Y=W.length;L<Y;L++){const k=new E(W[L]+"."+R[T.path],v.array,B,Ue);M.interpolation==="CUBICSPLINE"&&(k.createInterpolant=function(je){const Ve=this instanceof ye?Zt:$e;return new Ve(this.times,this.values,this.getValueSize()/3,je)},k.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),f.push(k)}}return new mt(s,void 0,f)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const n=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&n.traverse(function(o){if(o.isMesh)for(let a=0,h=s.weights.length;a<h;a++)o.morphTargetInfluences[a]=s.weights[a]}),n})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],r=i._loadNodeShallow(e),n=[],o=s.children||[];for(let h=0,l=o.length;h<l;h++)n.push(i.getDependency("node",o[h]));const a=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(n),a]).then(function(h){const l=h[0],c=h[1],d=h[2];d!==null&&l.traverse(function(p){p.isSkinnedMesh&&p.bind(d,oi)});for(let p=0,g=c.length;p<g;p++)l.add(c[p]);return l})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],n=r.name?s.createUniqueName(r.name):"",o=[],a=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return a&&o.push(a),r.camera!==void 0&&o.push(s.getDependency("camera",r.camera).then(function(h){return s._getNodeRef(s.cameraCache,r.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){o.push(h)}),this.nodeCache[e]=Promise.all(o).then(function(h){let l;if(r.isBone===!0?l=new gt:h.length>1?l=new ee:h.length===1?l=h[0]:l=new De,l!==h[0])for(let c=0,d=h.length;c<d;c++)l.add(h[c]);if(r.name&&(l.userData.name=r.name,l.name=n),P(l,r),r.extensions&&$(i,l,r),r.matrix!==void 0){const c=new V;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return s.associations.has(l)||s.associations.set(l,{}),s.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,r=new ee;i.name&&(r.name=s.createUniqueName(i.name)),P(r,i),i.extensions&&$(t,r,i);const n=i.nodes||[],o=[];for(let a=0,h=n.length;a<h;a++)o.push(s.getDependency("node",n[a]));return Promise.all(o).then(function(a){for(let l=0,c=a.length;l<c;l++)r.add(a[l]);const h=l=>{const c=new Map;for(const[d,p]of s.associations)(d instanceof Z||d instanceof ge)&&c.set(d,p);return l.traverse(d=>{const p=s.associations.get(d);p!=null&&c.set(d,p)}),c};return s.associations=h(r),r})}}function li(u,e,t){const i=e.attributes,s=new H;if(i.POSITION!==void 0){const o=t.json.accessors[i.POSITION],a=o.min,h=o.max;if(a!==void 0&&h!==void 0){if(s.set(new y(a[0],a[1],a[2]),new y(h[0],h[1],h[2])),o.normalized){const l=de(G[o.componentType]);s.min.multiplyScalar(l),s.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const o=new y,a=new y;for(let h=0,l=r.length;h<l;h++){const c=r[h];if(c.POSITION!==void 0){const d=t.json.accessors[c.POSITION],p=d.min,g=d.max;if(p!==void 0&&g!==void 0){if(a.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),a.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),a.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),d.normalized){const A=de(G[d.componentType]);a.multiplyScalar(A)}o.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}u.boundingBox=s;const n=new vt;s.getCenter(n.center),n.radius=s.min.distanceTo(s.max)/2,u.boundingSphere=n}function Le(u,e,t){const i=e.attributes,s=[];function r(n,o){return t.getDependency("accessor",n).then(function(a){u.setAttribute(o,a)})}for(const n in i){const o=ce[n]||n.toLowerCase();o in u.attributes||s.push(r(i[n],o))}if(e.indices!==void 0&&!u.index){const n=t.getDependency("accessor",e.indices).then(function(o){u.setIndex(o)});s.push(n)}return P(u,e),li(u,e,t),Promise.all(s).then(function(){return e.targets!==void 0?ii(u,e.targets,t):u})}const se=new WeakMap;class hi extends ke{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const r=new J(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,n=>{this.parse(n,t,s)},i,s)}parse(e,t,i){this.decodeDracoFile(e,t,null,null,I).catch(i)}decodeDracoFile(e,t,i,s,r=Tt){const n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){const i=JSON.stringify(t);if(se.has(e)){const a=se.get(e);if(a.key===i)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,n=e.byteLength,o=this._getWorker(r,n).then(a=>(s=a,new Promise((h,l)=>{s._callbacks[r]={resolve:h,reject:l},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return o.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),se.set(e,{key:i,promise:o}),o}_createGeometry(e){const t=new Be;e.index&&t.setIndex(new j(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],r=s.name,n=s.array,o=s.itemSize,a=new j(n,o);r==="color"&&this._assignVertexColorSpace(a,s.vertexColorSpace),t.setAttribute(r,a)}return t}_assignVertexColorSpace(e,t){if(t!==I)return;const i=new S;for(let s=0,r=e.count;s<r;s++)i.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new J(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=ci.toString(),n=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const n=r.data;switch(n.type){case"decode":s._callbacks[n.id].resolve(n);break;case"error":s._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function ci(){let u,e;onmessage=function(n){const o=n.data;switch(o.type){case"init":u=o.decoderConfig,e=new Promise(function(l){u.onModuleLoaded=function(c){l({draco:c})},DracoDecoderModule(u)});break;case"decode":const a=o.buffer,h=o.taskConfig;e.then(l=>{const c=l.draco,d=new c.Decoder;try{const p=t(c,d,new Int8Array(a),h),g=p.attributes.map(A=>A.array.buffer);p.index&&g.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},g)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{c.destroy(d)}});break}};function t(n,o,a,h){const l=h.attributeIDs,c=h.attributeTypes;let d,p;const g=o.GetEncodedGeometryType(a);if(g===n.TRIANGULAR_MESH)d=new n.Mesh,p=o.DecodeArrayToMesh(a,a.byteLength,d);else if(g===n.POINT_CLOUD)d=new n.PointCloud,p=o.DecodeArrayToPointCloud(a,a.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const A={index:null,attributes:[]};for(const f in l){const m=self[c[f]];let x,b;if(h.useUniqueIDs)b=l[f],x=o.GetAttributeByUniqueId(d,b);else{if(b=o.GetAttributeId(d,n[l[f]]),b===-1)continue;x=o.GetAttribute(d,b)}const v=s(n,o,d,f,m,x);f==="color"&&(v.vertexColorSpace=h.vertexColorSpace),A.attributes.push(v)}return g===n.TRIANGULAR_MESH&&(A.index=i(n,o,d)),n.destroy(d),A}function i(n,o,a){const l=a.num_faces()*3,c=l*4,d=n._malloc(c);o.GetTrianglesUInt32Array(a,c,d);const p=new Uint32Array(n.HEAPF32.buffer,d,l).slice();return n._free(d),{array:p,itemSize:1}}function s(n,o,a,h,l,c){const d=c.num_components(),g=a.num_points()*d,A=g*l.BYTES_PER_ELEMENT,f=r(n,l),m=n._malloc(A);o.GetAttributeDataArrayForAllPoints(a,c,f,A,m);const x=new l(n.HEAPF32.buffer,m,g).slice();return n._free(m),{name:h,array:x,itemSize:d}}function r(n,o){switch(o){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32}}}class di{constructor(){this.loadingManager=new _t,this.textureLoader=new Ie(this.loadingManager),this.gltfLoader=new Rt(this.loadingManager);const e=new hi;e.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),e.setDecoderConfig({type:"js"}),this.gltfLoader.setDRACOLoader(e)}loadGLB(e){return new Promise((t,i)=>{if(!e){i(new Error("Invalid path provided"));return}this.gltfLoader.load(e,s=>{if(!s.scene){i(new Error("Loaded GLTF has no scene property"));return}t(s)},s=>{console.log(`Loading ${e}: ${(s.loaded/s.total*100).toFixed(1)}%`)},s=>{console.error("GLB Load Error:",s),i(s)})})}}/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class C{constructor(e,t,i,s,r="div"){this.parent=e,this.object=t,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(s),this.$name=document.createElement("div"),this.$name.classList.add("name"),C.nextNameID=C.nextNameID||0,this.$name.id="lil-gui-name-"+ ++C.nextNameID,this.$widget=document.createElement(r),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class ui extends C{constructor(e,t,i){super(e,t,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function ue(u){let e,t;return(e=u.match(/(#|0x)?([a-f0-9]{6})/i))?t=e[2]:(e=u.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?t=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=u.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!t&&"#"+t}const pi={isPrimitive:!0,match:u=>typeof u=="string",fromHexString:ue,toHexString:ue},K={isPrimitive:!0,match:u=>typeof u=="number",fromHexString:u=>parseInt(u.substring(1),16),toHexString:u=>"#"+u.toString(16).padStart(6,0)},fi={isPrimitive:!1,match:Array.isArray,fromHexString(u,e,t=1){const i=K.fromHexString(u);e[0]=(i>>16&255)/255*t,e[1]=(i>>8&255)/255*t,e[2]=(255&i)/255*t},toHexString:([u,e,t],i=1)=>K.toHexString(u*(i=255/i)<<16^e*i<<8^t*i<<0)},mi={isPrimitive:!1,match:u=>Object(u)===u,fromHexString(u,e,t=1){const i=K.fromHexString(u);e.r=(i>>16&255)/255*t,e.g=(i>>8&255)/255*t,e.b=(255&i)/255*t},toHexString:({r:u,g:e,b:t},i=1)=>K.toHexString(u*(i=255/i)<<16^e*i<<8^t*i<<0)},gi=[pi,K,fi,mi];class yi extends C{constructor(e,t,i,s){var r;super(e,t,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(r=this.initialValue,gi.find(n=>n.match(r))),this._rgbScale=s,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const n=ue(this.$text.value);n&&this._setValueFromHexString(n)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class ne extends C{constructor(e,t,i){super(e,t,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",s=>{s.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class Ai extends C{constructor(e,t,i,s,r,n){super(e,t,i,"number"),this._initInput(),this.min(s),this.max(r);const o=n!==void 0;this.step(o?n:this._getImplicitStep(),o),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=100*t+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=l=>{const c=parseFloat(this.$input.value);isNaN(c)||(this._snapClampSetValue(c+l),this.$input.value=this.getValue())};let t,i,s,r,n,o=!1;const a=l=>{if(o){const c=l.clientX-t,d=l.clientY-i;Math.abs(d)>5?(l.preventDefault(),this.$input.blur(),o=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(c)>5&&h()}if(!o){const c=l.clientY-s;n-=c*this._step*this._arrowKeyMultiplier(l),r+n>this._max?n=this._max-r:r+n<this._min&&(n=this._min-r),this._snapClampSetValue(r+n)}s=l.clientY},h=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",h)};this.$input.addEventListener("input",()=>{let l=parseFloat(this.$input.value);isNaN(l)||(this._stepExplicit&&(l=this._snap(l)),this.setValue(this._clamp(l)))}),this.$input.addEventListener("keydown",l=>{l.code==="Enter"&&this.$input.blur(),l.code==="ArrowUp"&&(l.preventDefault(),e(this._step*this._arrowKeyMultiplier(l))),l.code==="ArrowDown"&&(l.preventDefault(),e(this._step*this._arrowKeyMultiplier(l)*-1))}),this.$input.addEventListener("wheel",l=>{this._inputFocused&&(l.preventDefault(),e(this._step*this._normalizeMouseWheel(l)))},{passive:!1}),this.$input.addEventListener("mousedown",l=>{t=l.clientX,i=s=l.clientY,o=!0,r=this.getValue(),n=0,window.addEventListener("mousemove",a),window.addEventListener("mouseup",h)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=d=>{const p=this.$slider.getBoundingClientRect();let g=(A=d,f=p.left,m=p.right,x=this._min,b=this._max,(A-f)/(m-f)*(b-x)+x);var A,f,m,x,b;this._snapClampSetValue(g)},t=d=>{e(d.clientX)},i=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i)};let s,r,n=!1;const o=d=>{d.preventDefault(),this._setDraggingStyle(!0),e(d.touches[0].clientX),n=!1},a=d=>{if(n){const p=d.touches[0].clientX-s,g=d.touches[0].clientY-r;Math.abs(p)>Math.abs(g)?o(d):(window.removeEventListener("touchmove",a),window.removeEventListener("touchend",h))}else d.preventDefault(),e(d.touches[0].clientX)},h=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",h)},l=this._callOnFinishChange.bind(this);let c;this.$slider.addEventListener("mousedown",d=>{this._setDraggingStyle(!0),e(d.clientX),window.addEventListener("mousemove",t),window.addEventListener("mouseup",i)}),this.$slider.addEventListener("touchstart",d=>{d.touches.length>1||(this._hasScrollBar?(s=d.touches[0].clientX,r=d.touches[0].clientY,n=!0):o(d),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",h))},{passive:!1}),this.$slider.addEventListener("wheel",d=>{if(Math.abs(d.deltaX)<Math.abs(d.deltaY)&&this._hasScrollBar)return;d.preventDefault();const p=this._normalizeMouseWheel(d)*this._step;this._snapClampSetValue(this.getValue()+p),this.$input.value=this.getValue(),clearTimeout(c),c=setTimeout(l,400)},{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle("lil-gui-"+t,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:i}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,i=-e.wheelDelta/120,i*=this._stepExplicit?1:10),t+-i}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){const t=Math.round(e/this._step)*this._step;return parseFloat(t.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class wi extends C{constructor(e,t,i,s){super(e,t,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(s)?s:Object.values(s),this._names=Array.isArray(s)?s:Object.keys(s),this._names.forEach(r=>{const n=document.createElement("option");n.innerHTML=r,this.$select.appendChild(n)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.innerHTML=t===-1?e:this._names[t],this}}class bi extends C{constructor(e,t,i){super(e,t,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",s=>{s.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Ce=!1;class pe{constructor({parent:e,autoPlace:t=e===void 0,container:i,width:s,title:r="Controls",injectStyles:n=!0,touchStyles:o=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",a=>{a.code!=="Enter"&&a.code!=="Space"||(a.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(r),o&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Ce&&n&&(function(a){const h=document.createElement("style");h.innerHTML=a;const l=document.querySelector("head link[rel=stylesheet], head style");l?document.head.insertBefore(h,l):document.head.appendChild(h)}('.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"↕";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"▾";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:"▸"}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"✓";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}'),Ce=!0),i?i.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),s&&this.domElement.style.setProperty("--width",s+"px"),this.domElement.addEventListener("keydown",a=>a.stopPropagation()),this.domElement.addEventListener("keyup",a=>a.stopPropagation())}add(e,t,i,s,r){if(Object(i)===i)return new wi(this,e,t,i);const n=e[t];switch(typeof n){case"number":return new Ai(this,e,t,i,s,r);case"boolean":return new ui(this,e,t);case"string":return new bi(this,e,t);case"function":return new ne(this,e,t)}console.error(`gui.add failed
	property:`,t,`
	object:`,e,`
	value:`,n)}addColor(e,t,i=1){return new yi(this,e,t,i)}addFolder(e){return new pe({parent:this,title:e})}load(e,t=!0){return e.controllers&&this.controllers.forEach(i=>{i instanceof ne||i._name in e.controllers&&i.load(e.controllers[i._name])}),t&&e.folders&&this.folders.forEach(i=>{i._title in e.folders&&i.load(e.folders[i._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(i=>{if(!(i instanceof ne)){if(i._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${i._name}"`);t.controllers[i._name]=i.save()}}),e&&this.folders.forEach(i=>{if(i._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${i._title}"`);t.folders[i._title]=i.save()}),t}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");const i=r=>{r.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const s=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=s+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(t=>t.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}class xi{constructor(){this.keys={forward:!1,backward:!1,left:!1,right:!1,space:!1,shift:!1,quit:!1},this.cameraRotation={left:!1,right:!1,up:!1,down:!1},this._Initialize()}_Initialize(){document.addEventListener("keydown",e=>this._onKeyDown(e),!1),document.addEventListener("keyup",e=>this._onKeyUp(e),!1)}_onKeyDown(e){switch(e.key.toLowerCase()){case"w":this.keys.forward=!0;break;case"a":this.keys.left=!0;break;case"s":this.keys.backward=!0;break;case"d":this.keys.right=!0;break;case" ":this.keys.space=!0;break;case"shift":this.keys.shift=!0;break;case"q":this.keys.quit=!0;break;case"arrowright":this.cameraRotation.left=!0;break;case"arrowleft":this.cameraRotation.right=!0;break;case"arrowup":this.cameraRotation.up=!0;break;case"arrowdown":this.cameraRotation.down=!0;break}}_onKeyUp(e){switch(e.key.toLowerCase()){case"w":this.keys.forward=!1;break;case"a":this.keys.left=!1;break;case"s":this.keys.backward=!1;break;case"d":this.keys.right=!1;break;case" ":this.keys.space=!1;break;case"shift":this.keys.shift=!1;break;case"q":this.keys.quit=!1;break;case"arrowright":this.cameraRotation.left=!1;break;case"arrowleft":this.cameraRotation.right=!1;break;case"arrowup":this.cameraRotation.up=!1;break;case"arrowdown":this.cameraRotation.down=!1;break}}resetMovementKeys(){console.log("Resetting movement keys in InputController."),this.keys.forward=!1,this.keys.backward=!1,this.keys.left=!1,this.keys.right=!1}}class vi{constructor(e){this.params=e,this.camera=e.camera,this.target=e.target,this.idealOffsetLocal=new y(0,15e3,-15e3),this.idealLookAtLocal=new y(0,50,100),this.currentPosition=new y,this.currentLookAt=new y,this.phi=e.phi||Math.PI/6,this.theta=e.theta||0,this.radius=this.idealOffsetLocal.length(),this.rotationSpeed=e.cameraRotateSpeed||1.5,this.phiSpeed=e.cameraRotateSpeed||1.5,this.phiClamp={min:-Math.PI/10,max:Math.PI/3},this._UpdateCamera()}_CalculateIdealOffset(){const e=this.idealOffsetLocal.clone(),t=new D().setFromAxisAngle(new y(0,1,0),this.theta);return e.applyQuaternion(t),e.add(this.target.position),e}_CalculateIdealLookat(){const e=this.idealLookAtLocal.clone(),t=new D().setFromAxisAngle(new y(0,1,0),this.theta);return e.applyQuaternion(t),e.add(this.target.position),e}_UpdateCamera(){const e=this._CalculateIdealOffset(),t=this._CalculateIdealLookat();this.currentPosition.copy(e),this.currentLookAt.copy(t),this.camera.position.copy(this.currentPosition),this.camera.lookAt(this.currentLookAt)}Update(e,t){if(this.params.freezeMovement)return this.theta;t.cameraRotation.left&&(this.theta+=this.rotationSpeed*e),t.cameraRotation.right&&(this.theta-=this.rotationSpeed*e),t.cameraRotation.up&&(this.phi=Math.min(this.phiClamp.max,this.phi+this.phiSpeed*e),this.idealOffsetLocal.x=0,this.idealOffsetLocal.y=this.radius*Math.sin(this.phi),this.idealOffsetLocal.z=-this.radius*Math.cos(this.phi)),t.cameraRotation.down&&(this.phi=Math.max(this.phiClamp.min,this.phi-this.phiSpeed*e),this.idealOffsetLocal.x=0,this.idealOffsetLocal.y=this.radius*Math.sin(this.phi),this.idealOffsetLocal.z=-this.radius*Math.cos(this.phi));const i=this._CalculateIdealOffset(),s=this._CalculateIdealLookat();return this.camera.position.copy(i),this.camera.lookAt(s),this.theta}}class Ti{constructor(e){this.params=e,this.model=e.model,this.scene=e.scene,this.collisionMeshes=e.collisionMeshes||[],this.audioLoader=e.audioLoader,this.listener=e.listener,this.isMuted=e.isMuted,this.coordinateOffset=e.coordinateOffset,this.gravity=e.gravity||-5e4,this.velocityY=0,this.isGrounded=!1,this.hoverHeight=e.hoverHeight||10,this.movementSpeed=800,this.movementSpeedMultiplier=e.movementSpeedMultiplier||10,this.runMultiplier=2,this.isJumping=!1,this.jumpStartTime=0,this.jumpDuration=1,this.initialJumpY=0,this.playerHeight=e.playerHeight||0,this.playerHalfWidth=e.playerHalfWidth||5,this.playerHalfDepth=e.playerHalfDepth||5,this.raycaster=new Ge,this.currentCollisionMesh=null,this.setupAudio(),this.isWalking=!1}setupAudio(){!this.audioLoader||!this.listener||(this.walkSound=this.params.walkSound||new Q(this.listener),this.jumpSound=this.params.jumpSound||new Q(this.listener),this.walkSound&&!this.walkSound.buffer&&this.audioLoader&&this.audioLoader.load("/audio/caminata.mp3",e=>{this.walkSound.setBuffer(e),this.walkSound.setLoop(!0),this.walkSound.setVolume(this.isMuted?0:10)}),this.jumpSound&&!this.jumpSound.buffer&&this.audioLoader&&this.audioLoader.load("/audio/salto.mp3",e=>{this.jumpSound.setBuffer(e),this.jumpSound.setVolume(this.isMuted?0:.5)}))}_HandleJump(e,t){if(t.keys.space&&this.isGrounded&&!this.isJumping&&(this.isJumping=!0,this.jumpStartTime=performance.now(),this.initialJumpY=this.model.position.y,this.isGrounded=!1,!this.isMuted&&this.jumpSound&&(this.jumpSound.isPlaying&&this.jumpSound.stop(),this.jumpSound.play())),this.isJumping){const s=(performance.now()-this.jumpStartTime)/1e3/this.jumpDuration;if(s<1){const n=this.initialJumpY+3e3*Math.sin(s*Math.PI);this.model.position.y=n}else this.isJumping=!1}}_CheckGrounded(){if(!this.model||!this.collisionMeshes||this.collisionMeshes.length===0)return this.isGrounded=!1,this.currentCollisionMesh=null,!1;const e=this.model.position.clone(),t=this.playerHalfWidth*.8,i=this.playerHalfDepth*.8,s=this.playerHeight*.1,r=this.playerHeight*.5+this.hoverHeight+100;this.raycaster.far=r;const n=[new y(e.x,e.y+s,e.z),new y(e.x+t,e.y+s,e.z+i),new y(e.x-t,e.y+s,e.z+i),new y(e.x+t,e.y+s,e.z-i),new y(e.x-t,e.y+s,e.z-i)];let o=-1/0,a=null;const h=this.collisionMeshes.filter(l=>l!==this.model);for(const l of n){this.raycaster.set(l,new y(0,-1,0));const c=this.raycaster.intersectObjects(h,!0);if(c.length>0)for(const d of c)d.point.y<l.y&&d.point.y>o&&(o=d.point.y,a=d.object)}if(o!==-1/0){const l=o+this.hoverHeight,c=this.hoverHeight*1.5;return!this.isJumping&&Math.abs(this.model.position.y-l)<c?(!this.isGrounded&&this.velocityY<0?(this.model.position.y=l,this.velocityY=0):this.model.position.y<l&&(this.model.position.y=l),this.isGrounded=!0):!this.isJumping&&this.model.position.y>l&&this.velocityY<=0?this.isGrounded=!1:!this.isJumping&&this.model.position.y<l?this.isGrounded=!1:this.isGrounded=!1,this.currentCollisionMesh=a,this.isGrounded}else return this.isGrounded=!1,this.currentCollisionMesh=null,!1}_ApplyGravity(e){!this.isGrounded&&!this.isJumping&&(this.velocityY+=this.gravity*e,this.velocityY=Math.max(this.velocityY,-2e4),this.model.position.y+=this.velocityY*e,this.model.position.y<=-16e3&&this.coordinateOffset&&(this.model.position.copy(this.coordinateOffset),this.velocityY=0,this.isGrounded=!0))}_HandleMovement(e,t,i){if(!this.model)return;this.model.rotation.y=i;const s=new y(Math.sin(i),0,Math.cos(i)),r=new y(Math.sin(i+Math.PI/2),0,Math.cos(i+Math.PI/2)),n=t.keys.shift?this.runMultiplier:1,o=this.movementSpeed*this.movementSpeedMultiplier*e*n;let a=!1;return t.keys.forward&&(this.model.position.x+=s.x*o,this.model.position.z+=s.z*o,a=!0),t.keys.backward&&(this.model.position.x-=s.x*o,this.model.position.z-=s.z*o,a=!0),t.keys.left&&(this.model.position.x+=r.x*o,this.model.position.z+=r.z*o,a=!0),t.keys.right&&(this.model.position.x-=r.x*o,this.model.position.z-=r.z*o,a=!0),this._UpdateWalkingSound(a),a}_UpdateWalkingSound(e){!this.walkSound||this.isMuted||(e&&this.isGrounded&&!this.isWalking?(this.isWalking=!0,this.walkSound.isPlaying||(this.walkSound.play(),this.walkSound.setVolume(10))):(!e||!this.isGrounded)&&this.isWalking&&(this.isWalking=!1,this.walkSound.isPlaying&&this.walkSound.stop()))}Update(e,t,i){if(this.params.freezeMovement)return this._UpdateWalkingSound(!1),{isMoving:!1,isGrounded:this.isGrounded,position:this.model.position,currentCollisionMesh:this.currentCollisionMesh};this._CheckGrounded(),this._HandleJump(e,t);const s=this._HandleMovement(e,t,i);return this.isJumping||this._ApplyGravity(e),{isMoving:s,isGrounded:this.isGrounded,position:this.model.position,currentCollisionMesh:this.currentCollisionMesh}}}class _i{constructor(e=!1){this.isMuted=e,this.initialized=!1,this.freezeMovement=!1,this.untexturedMeshes=[],this.untexturedWarningShown=!1,this.frozenByUntexturedWarning=!1,this.tempBox=new H,this.playerBox=new H,this.collisionMeshes=[],this.currentLevelPath=null,this.isDyingPhase1=!1,this.isMovingCameraToCenital=!1,this.isWaitingForDeathReload=!1,this.deathAnimationTimer=0,this.deathAnimationDuration=1.5,this.cenitalCameraAnimationTimer=0,this.cenitalCameraAnimationDuration=1.5,this.deathDelayTimer=0,this.deathDelayDuration=3,this.initialDeathPlayerPosition=new y,this.initialDeathXRotation=0,this.targetDeathXRotation=0,this.targetDeathYPosition=0,this.initialCameraPosition=new y,this.initialCameraQuaternion=new D,this.targetCameraPositionPhase1=new y,this.targetCameraQuaternionPhase1=new D,this.finalPlayerPosition=new y,this.initialCameraCenitalPosition=new y,this.targetCameraCenitalPosition=new y,this.initialCameraCenitalQuaternion=new D,this.targetCameraCenitalQuaternion=new D,this.isPreTeleportLock=!1,this.preTeleportLockTimer=0,this.preTeleportLockDuration=1,this.isTeleportingFreeze=!1,this.teleportFreezeTimer=0,this.teleportFreezeDuration=2,this.nextLevelPath=null,this.columpioMesh=null,this.orbitingLight=null,this.orbitCenter=new y(0,1e4,0),this.orbitRadius=5e5,this.orbitSpeed=.001,this.playerHeadLight=null,this.playerLightOffsetY=2500,this.playerLightOrbitRadius=1500,this.playerLightOrbitSpeed=2.5,this.orbitingChestIndex=1,this.playerChestOffsetY=3500,this.playerChestOrbitRadius=2500,this.playerChestOrbitSpeed=1.5,this.baseChestScene=null,this.chestSets=[],this.chestGravity=-5e4,this.chestHoverHeight=5,this.starYOffset=1e3,this.chestRaycaster=new Ge,this.time=0,this.clock=new Mt,this.renderer=new kt,this.scene=new Lt,this.camera=new he(45,window.innerWidth/window.innerHeight,.1,5e6),this.modelCenter=new y(0,-5,0),this.audioLoader=new Ct,this.listener=new St,this.camera.add(this.listener),this.theta=0,this.phi=0,this.radius=350,this.cameraRotateSpeed=1.5,this.coordDisplay=this._createCoordinateDisplay(),this.chestMessage=this._createChestMessage(),this._initializeGame(),window.addEventListener("resize",()=>this._onWindowResize(),!1),this.interactingChestSet=null,this.isMovingBackFromChest=!1,this.moveBackTimer=0,this.moveBackDuration=1,this.moveBackDistance=1e3,this.moveBackStartPosition=new y,this.moveBackTargetPosition=new y,this.moveBackStartRotationY=0,this.moveBackTotalRotation=Math.PI*6}async _initializeGame(){try{this._setupInput(),this.assetLoader=new di,console.log("Loading base player and chest models...");const[e,t]=await Promise.all([this.assetLoader.loadGLB("/models/newproject.glb"),this.assetLoader.loadGLB("/models/chest.glb")]);this.baseChestScene=t.scene,console.log("Base models loaded."),this._setupPlayer(e.scene),await this._loadLevel("/models/juegomapa334433.glb"),this._initializeCharacterController(),this._initializeCamera(),this._setupAudio(),this._setupGUI(),this.initialized=!0,this._startGameLoop();const i=document.getElementById("loading-screen");i&&(i.style.display="none")}catch(e){console.error("Error initializing game:",e)}}async _loadLevel(e){console.log(`Loading level: ${e}`),this.currentLevelPath=e,this.freezeMovement=!0;try{this.baseModel&&this.scene.remove(this.baseModel);const t=await this.assetLoader.loadGLB(e);this.baseModel=t.scene,this._setupLevelScene(this.baseModel),this._resetPlayerPosition(this.baseModel),this.character&&(this.character.coordinateOffset.copy(this.playerModel.position),this.character.collisionMeshes=this.collisionMeshes),t.animations&&t.animations.length>0?this._setupAnimations(t):this.mixer&&(this.mixer.stopAllAction(),this.mixer=null),console.log(`Level ${e} loaded successfully.`)}catch(t){throw console.error(`Error loading level ${e}:`,t),t}finally{!this.isTeleportingFreeze&&!this.isDyingPhase1&&(this.freezeMovement=!1),console.log("Movement frozen status after level load attempt:",this.freezeMovement)}}_setupPlayer(e){this.playerModel=e,e.scale.set(3e3,3e3,3e3),this.scene.add(e),e.updateMatrixWorld(!0);const t=new H().setFromObject(e);this.playerHeight=t.max.y-t.min.y,this.playerHalfWidth=(t.max.x-t.min.x)/2,this.playerHalfDepth=(t.max.z-t.min.z)/2,this.coordinateOffset=new y}_setupChest(e){this.chestModel=e,e.scale.set(500,500,500),this.scene.add(e),this._createStar(new y)}_resetPlayerPosition(e){let t=new y(0,5e3,0);const i=e.getObjectByName("piso");if(console.log(`Resetting player position for level: ${this.currentLevelPath}`),i){const s=new y;i.getWorldPosition(s);const r=new H().setFromObject(i),n=r.max.y;if(this.currentLevelPath.endsWith("juegomapa334433.glb")){console.log("Setting spawn for juegomapa334433.glb to piso center.");const o=new y;r.getCenter(o),t.set(o.x,n+5e3,o.z)}else this.currentLevelPath.endsWith("nivel1.glb")?(console.log("Setting spawn for nivel1.glb"),t.set(s.x+5e3,n+100,s.z-1e4)):(console.warn(`Unknown level path for spawn: ${this.currentLevelPath}. Using default offset.`),t.set(s.x,n+100,s.z));console.log("Player spawn point calculated:",t)}else console.warn("'piso' mesh not found in the new level. Using default world origin spawn point."),t.set(0,5e3,0);if(this.playerModel&&(this.playerModel.position.copy(t),this.playerModel.rotation.set(0,0,0),this.playerModel.updateMatrixWorld(!0),this.coordinateOffset.copy(t),console.log("Player position reset to:",this.playerModel.position)),this.character&&(this.character.velocityY=0,this.character.isGrounded=!1,this.character.isJumping=!1),this.cameraController&&(this.cameraController.theta=0,this.cameraController._UpdateCamera()),this.chestSets.forEach(s=>{this.scene.remove(s.chestModel),this.scene.remove(s.starMesh),this.scene.remove(s.starLight)}),this.chestSets=[],i){const s=new y;i.getWorldPosition(s);const n=new H().setFromObject(i).max.y;let o=new y,a=new y;if(this.currentLevelPath.endsWith("juegomapa334433.glb")){const h=new y(1e4,0,5e3);o.copy(t).add(h),o.y=n-4e3;const l=new y(-15e3,0,-8e3);a.copy(t).add(l),a.y=n+100}else this.currentLevelPath.endsWith("nivel1.glb")?(o.set(t.x+1e4,n+3e4,t.z),a.set(t.x-5e3,n+100,t.z+15e3)):(o.copy(t).add(new y(5e3,0,0)),o.y=n+3e4,a.copy(t).add(new y(-5e3,0,5e3)),a.y=n+100);this._addChestInstance(o,-Math.PI/6,1,!0),this._addChestInstance(a,Math.PI/4,100,!0)}else console.warn("'piso' not found, cannot accurately position chests. Placing defaults near player."),this._addChestInstance(t.clone().add(new y(5e3,3e4,0)),-Math.PI/6,1,!0),this._addChestInstance(t.clone().add(new y(-5e3,100,5e3)),Math.PI/4,1.5,!0)}_setupLevelScene(e){this.untexturedMeshes=[],this.collisionMeshes=[],this.planeMesh=null,this.cube010Mesh=null,this.columpioMesh=null,e.scale.set(300,300,300),e.position.set(0,-5,0),e.rotation.set(0,Math.PI/4,0),this.scene.add(e),console.log("--- Traversing New Level Scene Meshes ---"),e.traverse(t=>{if(t.isMesh){this.collisionMeshes.push(t),t.name==="piso"&&(this.planeMesh=t),t.name==="Cube010"&&(this.cube010Mesh=t),t.name==="columpio"&&(this.columpioMesh=t,console.log("Found 'columpio' mesh:",t)),t.castShadow=!0,t.receiveShadow=!0;const i=Array.isArray(t.material)?t.material:[t.material];let s=!1;for(const r of i)if(r&&r.map&&r.map.name==="notexturebro"){s=!0;break}s&&this.untexturedMeshes.push(t)}}),console.log(`--- Finished Traversing Level. Found ${this.collisionMeshes.length} potential collision meshes. ---`),this.planeMesh||console.warn("'piso' mesh not found in this level!"),this.columpioMesh||console.warn("'columpio' mesh not found in this level!"),this._setupLighting(),e.updateMatrixWorld(!0)}_createStar(e){const t=new Ae,i=5,s=20,r=40;t.moveTo(r,0);for(let h=0;h<2*i;h++){const l=h*Math.PI/i,c=h%2===0?r:s;t.lineTo(Math.cos(l)*c,Math.sin(l)*c)}t.closePath();const n={depth:1,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:5,bevelThickness:5},o=new we(t,n),a=new be({color:16776960,specular:1118481,shininess:1e3});this.starMesh=new le(o,a),this.starMesh.scale.set(4,4,4),this.starMesh.position.copy(e),this.starMesh.rotation.y=-Math.PI/4,this.scene.add(this.starMesh),this.starLight=new X(16761949,10,1e4,2),this.starLight.position.copy(this.starMesh.position),this.starLight.castShadow=!0,this.scene.add(this.starLight),this.starRotationSpeed=1.5}_setupLighting(){this.orbitingLight||(this.orbitingLight=new X(16711935,1.8,2e6,2),this.orbitingLight.name="replacementPointLight",this.scene.getObjectByName("replacementPointLight")||this.scene.add(this.orbitingLight));const e=new Pe(16777215,.01);e.position.set(50,100,-50),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=5e5,e.shadow.camera.left=-1e5,e.shadow.camera.right=1e5,e.shadow.camera.top=1e5,e.shadow.camera.bottom=-1e5,this.scene.getObjectByName("directionalLight")||(e.name="directionalLight",this.scene.add(e)),this.renderer.instance.shadowMap.enabled=!0,this.renderer.instance.shadowMap.type=Se}_setupInput(){this.input=new xi}_initializeCharacterController(){this.characterParams={model:this.playerModel,scene:this.scene,collisionMeshes:this.collisionMeshes,gravity:this.gravity||-5e4,audioLoader:this.audioLoader,listener:this.listener,isMuted:this.isMuted,walkSound:this.walkSound,jumpSound:this.jumpSound,playerHeight:this.playerHeight,playerHalfWidth:this.playerHalfWidth,playerHalfDepth:this.playerHalfDepth,coordinateOffset:this.coordinateOffset,movementSpeedMultiplier:this.movementSpeedMultiplier||15,hoverHeight:1050,freezeMovement:this.freezeMovement},this.character=new Ti(this.characterParams)}_initializeCamera(){this.cameraParams={camera:this.camera,target:this.playerModel,radius:this.radius,theta:this.theta,phi:this.phi,cameraRotateSpeed:this.cameraRotateSpeed,freezeMovement:this.freezeMovement},this.cameraController=new vi(this.cameraParams)}_setupAudio(){this.backgroundMusic=new Q(this.listener),this.audioLoader.load("/audio/cancionprincipal.mp3",e=>{this.backgroundMusic.setBuffer(e),this.backgroundMusic.setLoop(!0),this.backgroundMusic.setVolume(this.isMuted?0:.5),this.isMuted||(this.backgroundMusic.play(),this.isMusicPlaying=!0)}),this.creepyAudio=new Q(this.listener),this.audioLoader.load("/audio/pistacreepy.mp3",e=>{this.creepyAudio.setBuffer(e),this.creepyAudio.setLoop(!0),this.creepyAudio.setVolume(0)}),this.creepyDistance=1e4,this.isPlayingCreepy=!1}_setupAnimations(e){this.mixer=new Et(e.scene),e.animations.forEach(t=>{this.mixer.clipAction(t).play()})}_setupGUI(){new pe().add(this.character,"movementSpeedMultiplier",.5,100).name("Speed Multiplier")}_startGameLoop(){const e=()=>{if(requestAnimationFrame(e),!this.initialized)return;let t=!1;this.isDyingPhase1||this.isMovingCameraToCenital||this.isWaitingForDeathReload||this.isPreTeleportLock||this.isTeleportingFreeze||this.isMovingBackFromChest||this.frozenByUntexturedWarning?t=!0:t=this.freezeMovement,this.characterParams.freezeMovement=t,this.cameraParams.freezeMovement=t;const i=this.clock.getDelta();if(this.time+=i,this.playerModel&&!this.isDyingPhase1&&!this.isMovingCameraToCenital&&!this.isWaitingForDeathReload&&!this.isMovingBackFromChest&&this.playerBox.setFromObject(this.playerModel,!0),this.isDyingPhase1){this._updateDeathAnimationPhase1(i),this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isMovingCameraToCenital){this._updateCenitalCameraAnimation(i),this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isWaitingForDeathReload){this._updateDeathDelay(i),this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isPreTeleportLock){this._updatePreTeleportLock(i),this._updateChestPhysics(i),this.mixer&&this.mixer.update(i),this.chestSets.forEach(n=>{n.starMesh&&(n.starMesh.rotation.y+=this.starRotationSpeed*i)}),this._updateCoordinateDisplay(this.character.Update(0,this.input,this.cameraController.theta)),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isTeleportingFreeze){this._updateTeleportFreeze(i),this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isMovingBackFromChest){this._updateMoveBackFromChest(i),this._updateChestPhysics(i),this.mixer&&this.mixer.update(i),this.chestSets.forEach(n=>{n.starMesh&&(n.starMesh.rotation.y+=this.starRotationSpeed*i)}),this.renderer.instance.render(this.scene,this.camera);return}if(this.orbitingLight){const n=this.time*this.orbitSpeed;this.orbitingLight.position.set(this.orbitCenter.x,this.orbitCenter.y+this.orbitRadius*Math.sin(n),this.orbitCenter.z+this.orbitRadius*Math.cos(n))}const s=this.character.Update(i,this.input,this.cameraController.theta);if(this.orbitingLight&&this.chestSets.length>this.orbitingChestIndex&&this.chestSets[this.orbitingChestIndex]&&this.playerModel&&!t){const n=this.chestSets[this.orbitingChestIndex],o=this.time*this.playerChestOrbitSpeed,a=this.orbitingLight.position;n.chestModel.position.set(a.x+this.playerChestOrbitRadius*Math.cos(o),a.y+this.playerChestOffsetY,a.z+this.playerChestOrbitRadius*Math.sin(o)),n.velocityY=0,n.isGrounded=!0}this._updateChestPhysics(i),this.mixer&&this.mixer.update(i),this.chestSets.forEach(n=>{n.starMesh&&(n.starMesh.rotation.y+=this.starRotationSpeed*i)}),this.cameraController.Update(i,this.input),t||this.modelCenter.copy(this.playerModel.position),!t&&this.currentLevelPath&&this.currentLevelPath.endsWith("nivel1.glb")&&this.playerModel&&this.playerModel.position.y>=13500&&this._initiateDeathSequence(`Reached Y threshold (${this.playerModel.position.y.toFixed(0)}) in nivel1.glb`),this._handleProximityEvents(),this._updateCoordinateDisplay(s),this.renderer.instance.render(this.scene,this.camera)};e()}_updatePreTeleportLock(e){this.preTeleportLockTimer+=e,console.log(`Pre-Teleport lock timer: ${this.preTeleportLockTimer.toFixed(2)} / ${this.preTeleportLockDuration}`),this.preTeleportLockTimer>=this.preTeleportLockDuration&&(console.log("Pre-Teleport lock finished. Starting Teleport Freeze phase."),this.isPreTeleportLock=!1,this.preTeleportLockTimer=0,this.isTeleportingFreeze=!0,this.teleportFreezeTimer=0)}_updateTeleportFreeze(e){if(this.teleportFreezeTimer+=e,this.teleportFreezeTimer>=this.teleportFreezeDuration)if(console.log("Teleport freeze finished. Loading next level."),this.isTeleportingFreeze=!1,this.teleportFreezeTimer=0,this.nextLevelPath){const t=this.nextLevelPath;this.nextLevelPath=null,this._loadLevel(t).then(()=>{console.log("New level loaded successfully after teleport."),this.freezeMovement=!1}).catch(i=>{console.error("Failed to load next level after teleport:",i),this.freezeMovement=!1})}else console.warn("Teleport freeze ended, but no nextLevelPath was set."),this.freezeMovement=!1}_updateDeathAnimationPhase1(e){this.deathAnimationTimer+=e;const t=Math.min(this.deathAnimationTimer/this.deathAnimationDuration,1);this.playerModel.rotation.x=q.lerp(this.initialDeathXRotation,this.targetDeathXRotation,t);const i=q.lerp(this.initialDeathPlayerPosition.y,this.targetDeathYPosition,t);if(this.playerModel.position.y=i,this.camera.position.lerpVectors(this.initialCameraPosition,this.targetCameraPositionPhase1,t),this.camera.quaternion.slerpQuaternions(this.initialCameraQuaternion,this.targetCameraQuaternionPhase1,t),t>=1){console.log("Death Phase 1 complete. Starting Phase 2 (Move to Cenital)."),this.isDyingPhase1=!1,this.isMovingCameraToCenital=!0,this.finalPlayerPosition.copy(this.playerModel.position),this.initialCameraCenitalPosition.copy(this.camera.position),this.initialCameraCenitalQuaternion.copy(this.camera.quaternion),this.targetCameraCenitalPosition.set(this.finalPlayerPosition.x,this.finalPlayerPosition.y+5e3,this.finalPlayerPosition.z);const r=new he;r.position.copy(this.targetCameraCenitalPosition),r.lookAt(this.finalPlayerPosition),r.updateWorldMatrix(!0,!1),this.targetCameraCenitalQuaternion.copy(r.quaternion),this.cenitalCameraAnimationTimer=0}}_updateCenitalCameraAnimation(e){this.cenitalCameraAnimationTimer+=e;const t=Math.min(this.cenitalCameraAnimationTimer/this.cenitalCameraAnimationDuration,1);this.camera.position.lerpVectors(this.initialCameraCenitalPosition,this.targetCameraCenitalPosition,t),this.camera.quaternion.slerpQuaternions(this.initialCameraCenitalQuaternion,this.targetCameraCenitalQuaternion,t),t>=1&&(console.log("Death Phase 2 complete. Starting Phase 3 (Delay)."),this.isMovingCameraToCenital=!1,this.isWaitingForDeathReload=!0,this.deathDelayTimer=0)}_updateDeathDelay(e){this.deathDelayTimer+=e,this.camera.position.copy(this.targetCameraCenitalPosition),this.camera.quaternion.copy(this.targetCameraCenitalQuaternion),this.deathDelayTimer>=this.deathDelayDuration&&(console.log("Death Phase 3 complete. Game Over."),this.isWaitingForDeathReload=!1,alert("You died :("),window.location.reload())}_handleProximityEvents(){if(this.isDyingPhase1||this.isMovingCameraToCenital||this.isWaitingForDeathReload||this.isPreTeleportLock||this.isTeleportingFreeze||this.isMovingBackFromChest)return;if(this.columpioMesh&&this.playerModel&&!this.freezeMovement&&(this.columpioMesh.updateMatrixWorld(!0),this.tempBox.setFromObject(this.columpioMesh,!0),this.playerBox.intersectsBox(this.tempBox))){console.log("Player collided with columpio! Initiating Pre-Teleport Lock."),this.isPreTeleportLock=!0,this.freezeMovement=!0,this.input.resetMovementKeys(),this.preTeleportLockTimer=0,this.nextLevelPath="/models/nivel1.glb";return}let e=!1;const t=1e5;if(this.playerModel&&this.untexturedMeshes.length>0&&!this.freezeMovement){for(const n of this.untexturedMeshes)if(n&&n.geometry){if(n.updateMatrixWorld(!0),this.tempBox.setFromObject(n,!0),this.playerBox.intersectsBox(this.tempBox)){this._initiateDeathSequence("Collision with untextured mesh");return}this.tempBox.distanceToPoint(this.playerModel.position)<t&&(e=!0,this.untexturedWarningShown||(console.log("Near untextured, freezing movement for warning."),this.freezeMovement=!0,this.frozenByUntexturedWarning=!0,this.characterParams.freezeMovement=!0,this.cameraParams.freezeMovement=!0,alert("WARNING! Getting closer..."),console.log("Alert dismissed, unfreezing movement and resetting input."),this.freezeMovement=!1,this.frozenByUntexturedWarning=!1,this.untexturedWarningShown=!0,this.input.resetMovementKeys()))}}!e&&this.untexturedWarningShown&&!this.frozenByUntexturedWarning&&!this.isDyingPhase1&&!this.isPreTeleportLock&&!this.isTeleportingFreeze&&(console.log("Away from all untextured meshes (for warning), resetting shown flag."),this.untexturedWarningShown=!1);let i=!1,s=null;if(this.playerModel&&!this.freezeMovement&&this.chestSets.length>0){for(const n of this.chestSets)if(this.playerModel.position.distanceTo(n.chestModel.position)<1e3){i=!0,s=n;break}}if(i&&!this.freezeMovement&&(console.log("Near a chest, freezing movement."),this.freezeMovement=!0,this.interactingChestSet=s,this.frozenByUntexturedWarning=!1,this.characterParams.freezeMovement=!0,this.cameraParams.freezeMovement=!0,this.chestMessage.style.display="block",this.coordDisplay.style.display="none"),this.freezeMovement&&this.interactingChestSet&&!this.frozenByUntexturedWarning&&!this.isPreTeleportLock&&!this.isTeleportingFreeze&&!this.isDyingPhase1&&this.input.keys.quit&&this.chestMessage.style.display==="block"){console.log("Q pressed near chest. Initiating move back.");const n=new y;n.subVectors(this.playerModel.position,this.interactingChestSet.chestModel.position),n.y=0,n.normalize(),this.moveBackStartPosition.copy(this.playerModel.position),this.moveBackTargetPosition.copy(this.playerModel.position).addScaledVector(n,this.moveBackDistance),this.moveBackStartRotationY=this.playerModel.rotation.y,this.isMovingBackFromChest=!0,this.moveBackTimer=0,this.chestMessage.style.display="none",this.input.keys.quit=!1}}_updateCoordinateDisplay(e){var s;if(!this.coordDisplay||!this.playerModel)return;const t=this.playerModel.position.clone().sub(this.coordinateOffset),i=e.currentCollisionMesh?e.currentCollisionMesh.name||"Unnamed Mesh":"None";this.coordDisplay.textContent=`X: ${t.x.toFixed(1)} • Y: ${t.y.toFixed(1)} • Z: ${t.z.toFixed(1)} 
VelY: ${((s=this.character.velocityY)==null?void 0:s.toFixed(1))||"0.0"} • Grounded: ${e.isGrounded?"YES":"NO"} 
Colliding with: ${i}`}_onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.instance.setSize(window.innerWidth,window.innerHeight)}_createCoordinateDisplay(){const e=document.createElement("div");return e.style.cssText=`
      position: fixed;
      bottom: 20px;
      left: 20px;
      color: white;
      font-family: monospace;
      background: rgba(0,0,0,0.7);
      padding: 8px;
      border-radius: 4px;
      z-index: 1000;
    `,document.body.appendChild(e),e}_createChestMessage(){const e=document.createElement("div");return e.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: Arial, sans-serif;
      font-size: 2em;
      text-align: center;
      background: rgba(0,0,0,0.8);
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 1001;
    `,e.textContent="Wow! A chest! I wonder what's inside",document.body.appendChild(e),e}_updateChestPhysics(e){if(!this.chestSets||this.chestSets.length===0)return;const t=this.chestSets.map(i=>i.chestModel.uuid);for(let i=0;i<this.chestSets.length;i++){const s=this.chestSets[i],{chestModel:r}=s;if(r.updateMatrixWorld(!0),s.ignorePhysics||i===this.orbitingChestIndex)s.velocityY=0,s.isGrounded=!0;else{const n=this._getGroundHeightBelowChest(r.position,t);if(n!==-1/0){const o=n+this.chestHoverHeight;Math.abs(r.position.y-o)<5||r.position.y>o&&s.velocityY<=0?(s.isGrounded||(r.position.y=o),s.velocityY=0,s.isGrounded=!0):s.isGrounded=!1}else s.isGrounded=!1;if(!s.isGrounded){s.velocityY+=this.chestGravity*e,s.velocityY=Math.max(s.velocityY,-2e4);const o=s.velocityY*e;r.position.y+=o,r.position.y<-3e4&&(console.warn("A chest fell too far, resetting position near player."),this.playerModel?r.position.copy(this.playerModel.position).add(new y(2e3,500,0)):r.position.set(0,5e3,0),s.velocityY=0,s.isGrounded=!0)}}}this._updateAllStarAndLightPositions()}_getGroundHeightBelowChest(e,t){const i=e.clone();if(i.y+=10,this.chestRaycaster.set(i,new y(0,-1,0)),this.chestRaycaster.far=e.y+31e3,!this.collisionMeshes||this.collisionMeshes.length===0)return-1/0;const s=this.collisionMeshes.filter(n=>!t.includes(n.uuid)),r=this.chestRaycaster.intersectObjects(s,!0);if(r.length>0){let n=-1/0;for(const o of r)o.point.y<i.y&&o.point.y>n&&(n=o.point.y);return n}else return-1/0}_addChestInstance(e,t=0,i=1,s=!1){if(!this.baseChestScene)return console.error("Base chest scene not loaded!"),null;const r=this.baseChestScene.clone();r.scale.set(500*i,500*i,500*i),r.position.copy(e),r.rotation.y=t,this.scene.add(r);const n=new Ae,o=5,a=20,h=40;n.moveTo(h,0);for(let m=0;m<2*o;m++){const x=m*Math.PI/o,b=m%2===0?h:a;n.lineTo(Math.cos(x)*b,Math.sin(x)*b)}n.closePath();const l={depth:1,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:5,bevelThickness:5},c=new we(n,l),d=new be({color:16776960,specular:1118481,shininess:1e3}),p=new le(c,d);p.scale.set(4*i,4*i,4*i),p.rotation.y=-Math.PI/4,p.position.set(e.x,e.y+this.starYOffset*i,e.z-400*i),this.scene.add(p);const g=1e4*i,A=new X(16761949,10,g,2);A.castShadow=!0,A.position.copy(p.position),this.scene.add(A);const f={chestModel:r,starMesh:p,starLight:A,velocityY:0,isGrounded:s,scaleFactor:i,ignorePhysics:s};return this.chestSets.push(f),console.log("Added chest instance at:",e,` Scale: ${i}, IgnorePhysics: ${s}, Total chests: ${this.chestSets.length}`),f}_updateAllStarAndLightPositions(){if(!(!this.chestSets||this.chestSets.length===0))for(const e of this.chestSets){const t=e.scaleFactor||1;e.starMesh.position.set(e.chestModel.position.x,e.chestModel.position.y+this.starYOffset*t,e.chestModel.position.z-400*t),e.starLight.position.copy(e.starMesh.position)}}_updateMoveBackFromChest(e){this.moveBackTimer+=e;const t=Math.min(this.moveBackTimer/this.moveBackDuration,1);this.playerModel.position.lerpVectors(this.moveBackStartPosition,this.moveBackTargetPosition,t);const i=this.moveBackStartRotationY+this.moveBackTotalRotation;this.playerModel.rotation.y=q.lerp(this.moveBackStartRotationY,i,t),t>=1&&(console.log("Finished moving back from chest. Resuming control."),this.isMovingBackFromChest=!1,this.freezeMovement=!1,this.interactingChestSet=null,this.characterParams.freezeMovement=!1,this.cameraParams.freezeMovement=!1,this.coordDisplay.style.display="block",this.playerModel.rotation.y=this.cameraController.theta,this.input.resetMovementKeys())}_initiateDeathSequence(e){console.log(`Initiating death sequence. Reason: ${e}`),this.isDyingPhase1=!0,this.freezeMovement=!0,this.frozenByUntexturedWarning=!1,this.characterParams.freezeMovement=!0,this.cameraParams.freezeMovement=!0,this.input.resetMovementKeys(),this.initialDeathPlayerPosition.copy(this.playerModel.position),this.initialDeathXRotation=this.playerModel.rotation.x,this.initialCameraPosition.copy(this.camera.position),this.initialCameraQuaternion.copy(this.camera.quaternion),this.targetDeathXRotation=this.initialDeathXRotation+Math.PI/2,this.targetDeathYPosition=this.initialDeathPlayerPosition.y-(e.includes("Y threshold")?3e3:1e3);const t=new y(0,1500,-2e3);this.targetCameraPositionPhase1.copy(this.initialDeathPlayerPosition).add(t);const i=new V;i.lookAt(this.targetCameraPositionPhase1,this.initialDeathPlayerPosition,this.camera.up),this.targetCameraQuaternionPhase1.setFromRotationMatrix(i),this.deathAnimationTimer=0}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded event fired.");const u=document.getElementById("startGameButton"),e=document.getElementById("startMutedButton"),t=document.getElementById("game-buttons");if(console.log("startButton found:",u),console.log("mutedButton found:",e),console.log("buttonsContainer found:",t),u&&e&&t){let i=function(s=!1){console.log(`startGame called with muted = ${s}`),t&&(console.log("Hiding buttons container."),t.style.display="none"),console.log("Creating new Game instance..."),new _i(s),console.log("New Game instance created.")};console.log("Buttons and container found, attaching listeners."),u.addEventListener("click",()=>{console.log("Start Game button clicked!"),i(!1)}),e.addEventListener("click",()=>{console.log("Start Muted button clicked!"),i(!0)}),console.log("Event listeners attached.")}else console.warn("One or more start elements (buttons or container) not found!")});
