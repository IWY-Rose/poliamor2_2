/* empty css             */import{W as pe,P as _e,S as D,C,T as Ue,a as se,b as Me,L as ve,c as ne,F as Y,M as O,V as Le,d as je,e as Ee,D as Ce,f as X,g as A,I as Ve,Q as B,O as Se,h as ke,i as We,B as j,j as Ke,k as Re,N as Ye,l as Xe,m as qe,n as Pe,o as Je,R as re,p as Qe,q as Ze,r as et,s as J,t as tt,u as De,v as it,w as U,x as st,y as Ie,z as nt,A as Oe,E as rt,G as ot,H as at,J as lt,K as Q,U as oe,X as ae,Y as ht,Z as ct,_ as dt,$ as Ne,a0 as ut,a1 as pt,a2 as ft,a3 as fe,a4 as mt,a5 as me,a6 as gt,a7 as yt,a8 as At,a9 as H,aa as wt,ab as bt,ac as xt,ad as Fe,ae as Tt,af as _t,ag as Mt,ah as vt,ai as Lt,aj as Et,ak as Ct,al as St,am as q,an as kt}from"./three-DAyXsNa1.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class Rt{constructor(){const e=document.querySelector("#gameCanvas");if(!e)throw new Error("Canvas element not found!");try{new pe().dispose()}catch(t){const i=document.createElement("div");throw i.textContent="WebGL not supported: "+t.message,document.body.appendChild(i),t}this.renderer=new pe({canvas:e,antialias:!0,powerPreference:"high-performance",logarithmicDepthBuffer:!0,shadowMapEnabled:!0}),this.renderer.autoClear=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=_e,this.renderer.outputColorSpace=D,this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setClearColor(new C(8900331),1),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight)}get instance(){return this.renderer}}function ge(u,e){if(e===Ue)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),u;if(e===se||e===Me){let t=u.getIndex();if(t===null){const r=[],a=u.getAttribute("position");if(a!==void 0){for(let o=0;o<a.count;o++)r.push(o);u.setIndex(r),t=u.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),u}const i=t.count-2,s=[];if(e===se)for(let r=1;r<=i;r++)s.push(t.getX(0)),s.push(t.getX(r)),s.push(t.getX(r+1));else for(let r=0;r<i;r++)r%2===0?(s.push(t.getX(r)),s.push(t.getX(r+1)),s.push(t.getX(r+2))):(s.push(t.getX(r+2)),s.push(t.getX(r+1)),s.push(t.getX(r)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const n=u.clone();return n.setIndex(s),n.clearGroups(),n}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),u}class Pt extends ve{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ft(t)}),this.register(function(t){return new jt(t)}),this.register(function(t){return new Vt(t)}),this.register(function(t){return new Wt(t)}),this.register(function(t){return new Gt(t)}),this.register(function(t){return new Bt(t)}),this.register(function(t){return new zt(t)}),this.register(function(t){return new $t(t)}),this.register(function(t){return new Nt(t)}),this.register(function(t){return new Ut(t)}),this.register(function(t){return new Ht(t)}),this.register(function(t){return new It(t)}),this.register(function(t){return new Kt(t)}),this.register(function(t){return new Yt(t)})}load(e,t,i,s){const n=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=ne.extractUrlBase(e),this.manager.itemStart(e);const a=function(h){s?s(h):console.error(h),n.manager.itemError(e),n.manager.itemEnd(e)},o=new Y(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(h){try{n.parse(h,r,function(l){t(l),n.manager.itemEnd(e)},a)}catch(l){a(l)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let n;const r={},a={},o=new TextDecoder;if(typeof e=="string")n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===He){try{r[w.KHR_BINARY_GLTF]=new Xt(e)}catch(c){s&&s(c);return}n=JSON.parse(r[w.KHR_BINARY_GLTF].content)}else n=JSON.parse(o.decode(e));else n=e;if(n.asset===void 0||n.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new li(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const c=this.pluginCallbacks[l](h);a[c.name]=c,r[c.name]=!0}if(n.extensionsUsed)for(let l=0;l<n.extensionsUsed.length;++l){const c=n.extensionsUsed[l],d=n.extensionsRequired||[];switch(c){case w.KHR_MATERIALS_UNLIT:r[c]=new Ot;break;case w.KHR_DRACO_MESH_COMPRESSION:r[c]=new qt(n,this.dracoLoader);break;case w.KHR_TEXTURE_TRANSFORM:r[c]=new Jt;break;case w.KHR_MESH_QUANTIZATION:r[c]=new Qt;break;default:d.indexOf(c)>=0&&a[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}h.setExtensions(r),h.setPlugins(a),h.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,n){i.parse(e,t,s,n)})}}function Dt(){let u={};return{get:function(e){return u[e]},add:function(e,t){u[e]=t},remove:function(e){delete u[e]},removeAll:function(){u={}}}}const w={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class It{constructor(e){this.parser=e,this.name=w.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const n=t[i];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const n=t.json,o=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let h;const l=new C(16777215);o.color!==void 0&&l.fromArray(o.color);const c=o.range!==void 0?o.range:0;switch(o.type){case"directional":h=new Ce(l),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new Ee(l),h.distance=c;break;case"spot":h=new je(l),h.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,h.angle=o.spot.outerConeAngle,h.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return h.position.set(0,0,0),h.decay=2,P(h,o),o.intensity!==void 0&&(h.intensity=o.intensity),h.name=t.createUniqueName(o.name||"light_"+e),s=Promise.resolve(h),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,n=i.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(o){return i._getNodeRef(t.cache,a,o)})}}class Ot{constructor(){this.name=w.KHR_MATERIALS_UNLIT}getMaterialType(){return U}extendParams(e,t,i){const s=[];e.color=new C(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const r=n.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}n.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",n.baseColorTexture,D))}return Promise.all(s)}}class Nt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return n!==void 0&&(t.emissiveIntensity=n),Promise.resolve()}}class Ft{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:O}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&n.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&n.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(n.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Le(a,a)}return Promise.all(n)}}class Ht{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:O}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&n.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&n.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}}class Gt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:O}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new C(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];return r.sheenColorFactor!==void 0&&t.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&n.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,D)),r.sheenRoughnessTexture!==void 0&&n.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(n)}}class Bt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:O}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&n.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(n)}}class zt{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:O}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&n.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new C(a[0],a[1],a[2]),Promise.all(n)}}class $t{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:O}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}}class Ut{constructor(e){this.parser=e,this.name=w.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:O}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&n.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new C(a[0],a[1],a[2]),r.specularColorTexture!==void 0&&n.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,D)),Promise.all(n)}}class jt{constructor(e){this.parser=e,this.name=w.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,r)}}class Vt{constructor(e){this.parser=e,this.name=w.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=s.images[r.source];let o=i.textureLoader;if(a.uri){const h=i.options.manager.getHandler(a.uri);h!==null&&(o=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,r.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Wt{constructor(e){this.parser=e,this.name=w.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=s.images[r.source];let o=i.textureLoader;if(a.uri){const h=i.options.manager.getHandler(a.uri);h!==null&&(o=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,r.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Kt{constructor(e){this.name=w.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],n=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(a){const o=s.byteOffset||0,h=s.byteLength||0,l=s.count,c=s.byteStride,d=new Uint8Array(a,o,h);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(l,c,d,s.mode,s.filter).then(function(p){return p.buffer}):r.ready.then(function(){const p=new ArrayBuffer(l*c);return r.decodeGltfBuffer(new Uint8Array(p),l,c,d,s.mode,s.filter),p})})}else return null}}class Yt{constructor(e){this.name=w.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const h of s.primitives)if(h.mode!==M.TRIANGLES&&h.mode!==M.TRIANGLE_STRIP&&h.mode!==M.TRIANGLE_FAN&&h.mode!==void 0)return null;const r=i.extensions[this.name].attributes,a=[],o={};for(const h in r)a.push(this.parser.getDependency("accessor",r[h]).then(l=>(o[h]=l,o[h])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(h=>{const l=h.pop(),c=l.isGroup?l.children:[l],d=h[0].count,p=[];for(const m of c){const y=new X,f=new A,g=new B,x=new A(1,1,1),b=new Ve(m.geometry,m.material,d);for(let T=0;T<d;T++)o.TRANSLATION&&f.fromBufferAttribute(o.TRANSLATION,T),o.ROTATION&&g.fromBufferAttribute(o.ROTATION,T),o.SCALE&&x.fromBufferAttribute(o.SCALE,T),b.setMatrixAt(T,y.compose(f,g,x));for(const T in o)T!=="TRANSLATION"&&T!=="ROTATION"&&T!=="SCALE"&&m.geometry.setAttribute(T,o[T]);Se.prototype.copy.call(b,m),this.parser.assignFinalMaterial(b),p.push(b)}return l.isGroup?(l.clear(),l.add(...p),l):p[0]}))}}const He="glTF",z=12,ye={JSON:1313821514,BIN:5130562};class Xt{constructor(e){this.name=w.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,z),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==He)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-z,n=new DataView(e,z);let r=0;for(;r<s;){const a=n.getUint32(r,!0);r+=4;const o=n.getUint32(r,!0);if(r+=4,o===ye.JSON){const h=new Uint8Array(e,z+r,a);this.content=i.decode(h)}else if(o===ye.BIN){const h=z+r;this.body=e.slice(h,h+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class qt{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=w.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,n=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},o={},h={};for(const l in r){const c=le[l]||l.toLowerCase();a[c]=r[l]}for(const l in e.attributes){const c=le[l]||l.toLowerCase();if(r[l]!==void 0){const d=i.accessors[e.attributes[l]],p=G[d.componentType];h[c]=p.name,o[c]=d.normalized===!0}}return t.getDependency("bufferView",n).then(function(l){return new Promise(function(c){s.decodeDracoFile(l,function(d){for(const p in d.attributes){const m=d.attributes[p],y=o[p];y!==void 0&&(m.normalized=y)}c(d)},a,h)})})}}class Jt{constructor(){this.name=w.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Qt{constructor(){this.name=w.KHR_MESH_QUANTIZATION}}class Ge extends At{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=e*s*3+s;for(let r=0;r!==s;r++)t[r]=i[n+r];return t}interpolate_(e,t,i,s){const n=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=a*2,h=a*3,l=s-t,c=(i-t)/l,d=c*c,p=d*c,m=e*h,y=m-h,f=-2*p+3*d,g=p-d,x=1-f,b=g-d+c;for(let T=0;T!==a;T++){const I=r[y+T+a],v=r[y+T+o]*l,_=r[m+T+a],S=r[m+T]*l;n[T]=x*I+b*v+f*_+g*S}return n}}const Zt=new B;class ei extends Ge{interpolate_(e,t,i,s){const n=super.interpolate_(e,t,i,s);return Zt.fromArray(n).normalize().toArray(n),n}}const M={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},G={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ae={9728:Je,9729:Pe,9984:qe,9985:Xe,9986:Ye,9987:Re},we={33071:Ze,33648:Qe,10497:re},Z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},le={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ti={CUBICSPLINE:void 0,LINEAR:Ne,STEP:dt},ee={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ii(u){return u.DefaultMaterial===void 0&&(u.DefaultMaterial=new De({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:yt})),u.DefaultMaterial}function $(u,e,t){for(const i in t.extensions)u[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function P(u,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(u.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function si(u,e,t){let i=!1,s=!1,n=!1;for(let h=0,l=e.length;h<l;h++){const c=e[h];if(c.POSITION!==void 0&&(i=!0),c.NORMAL!==void 0&&(s=!0),c.COLOR_0!==void 0&&(n=!0),i&&s&&n)break}if(!i&&!s&&!n)return Promise.resolve(u);const r=[],a=[],o=[];for(let h=0,l=e.length;h<l;h++){const c=e[h];if(i){const d=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):u.attributes.position;r.push(d)}if(s){const d=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):u.attributes.normal;a.push(d)}if(n){const d=c.COLOR_0!==void 0?t.getDependency("accessor",c.COLOR_0):u.attributes.color;o.push(d)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o)]).then(function(h){const l=h[0],c=h[1],d=h[2];return i&&(u.morphAttributes.position=l),s&&(u.morphAttributes.normal=c),n&&(u.morphAttributes.color=d),u.morphTargetsRelative=!0,u})}function ni(u,e){if(u.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)u.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(u.morphTargetInfluences.length===t.length){u.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)u.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ri(u){const e=u.extensions&&u.extensions[w.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+be(e.attributes):t=u.indices+":"+be(u.attributes)+":"+u.mode,t}function be(u){let e="";const t=Object.keys(u).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+u[t[i]]+";";return e}function he(u){switch(u){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function oi(u){return u.search(/\.jpe?g($|\?)/i)>0||u.search(/^data\:image\/jpeg/)===0?"image/jpeg":u.search(/\.webp($|\?)/i)>0||u.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const ai=new X;class li{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Dt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,n=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,n=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&n<98?this.textureLoader=new ke(this.options.manager):this.textureLoader=new We(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Y(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:i,userData:{}};$(n,a,s),P(a,s),Promise.all(i._invokeAll(function(o){return o.afterRoot&&o.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,n=t.length;s<n;s++){const r=t[s].joints;for(let a=0,o=r.length;a<o;a++)e[r[a]].isBone=!0}for(let s=0,n=e.length;s<n;s++){const r=e[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(i[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),n=(r,a)=>{const o=this.associations.get(r);o!=null&&this.associations.set(a,o);for(const[h,l]of r.children.entries())n(l,a.children[h])};return n(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const n=e(t[s]);n&&i.push(n)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(n){return n.loadNode&&n.loadNode(t)});break;case"mesh":s=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(n,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[w.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(n,r){i.load(ne.resolveURL(t.uri,s.path),n,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,n=t.byteOffset||0;return i.slice(n,n+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const r=Z[s.type],a=G[s.componentType],o=s.normalized===!0,h=new a(s.count*r);return Promise.resolve(new j(h,r,o))}const n=[];return s.bufferView!==void 0?n.push(this.getDependency("bufferView",s.bufferView)):n.push(null),s.sparse!==void 0&&(n.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(n).then(function(r){const a=r[0],o=Z[s.type],h=G[s.componentType],l=h.BYTES_PER_ELEMENT,c=l*o,d=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let y,f;if(p&&p!==c){const g=Math.floor(d/p),x="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+g+":"+s.count;let b=t.cache.get(x);b||(y=new h(a,g*p,s.count*p/l),b=new Ke(y,p/l),t.cache.add(x,b)),f=new ft(b,o,d%p/l,m)}else a===null?y=new h(s.count*o):y=new h(a,d,s.count*o),f=new j(y,o,m);if(s.sparse!==void 0){const g=Z.SCALAR,x=G[s.sparse.indices.componentType],b=s.sparse.indices.byteOffset||0,T=s.sparse.values.byteOffset||0,I=new x(r[1],b,s.sparse.count*g),v=new h(r[2],T,s.sparse.count*o);a!==null&&(f=new j(f.array.slice(),f.itemSize,f.normalized));for(let _=0,S=I.length;_<S;_++){const N=I[_];if(f.setX(N,v[_*o]),o>=2&&f.setY(N,v[_*o+1]),o>=3&&f.setZ(N,v[_*o+2]),o>=4&&f.setW(N,v[_*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e].source,r=t.images[n];let a=this.textureLoader;if(r.uri){const o=i.manager.getHandler(r.uri);o!==null&&(a=o)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,i){const s=this,n=this.json,r=n.textures[e],a=n.images[t],o=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[o])return this.textureCache[o];const h=this.loadImageSource(t,i).then(function(l){l.flipY=!1,l.name=r.name||a.name||"",l.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(l.name=a.uri);const d=(n.samplers||{})[r.sampler]||{};return l.magFilter=Ae[d.magFilter]||Pe,l.minFilter=Ae[d.minFilter]||Re,l.wrapS=we[d.wrapS]||re,l.wrapT=we[d.wrapT]||re,s.associations.set(l,{textures:e}),l}).catch(function(){return null});return this.textureCache[o]=h,h}loadImageSource(e,t){const i=this,s=this.json,n=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(c=>c.clone());const r=s.images[e],a=self.URL||self.webkitURL;let o=r.uri||"",h=!1;if(r.bufferView!==void 0)o=i.getDependency("bufferView",r.bufferView).then(function(c){h=!0;const d=new Blob([c],{type:r.mimeType});return o=a.createObjectURL(d),o});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then(function(c){return new Promise(function(d,p){let m=d;t.isImageBitmapLoader===!0&&(m=function(y){const f=new fe(y);f.needsUpdate=!0,d(f)}),t.load(ne.resolveURL(c,n.path),m,void 0,p)})}).then(function(c){return h===!0&&a.revokeObjectURL(o),c.userData.mimeType=r.mimeType||oi(r.uri),c}).catch(function(c){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),c});return this.sourceCache[e]=l,l}assignTexture(e,t,i,s){const n=this;return this.getDependency("texture",i.index).then(function(r){if(!r)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(r=r.clone(),r.channel=i.texCoord),n.extensions[w.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[w.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const o=n.associations.get(r);r=n.extensions[w.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),n.associations.set(r,o)}}return s!==void 0&&(r.colorSpace=s),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,n=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let o=this.cache.get(a);o||(o=new et,J.prototype.copy.call(o,i),o.color.copy(i.color),o.map=i.map,o.sizeAttenuation=!1,this.cache.add(a,o)),i=o}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let o=this.cache.get(a);o||(o=new tt,J.prototype.copy.call(o,i),o.color.copy(i.color),o.map=i.map,this.cache.add(a,o)),i=o}if(s||n||r){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),n&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let o=this.cache.get(a);o||(o=i.clone(),n&&(o.vertexColors=!0),r&&(o.flatShading=!0),s&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(a,o),this.associations.set(o,this.associations.get(i))),i=o}e.material=i}getMaterialType(){return De}loadMaterial(e){const t=this,i=this.json,s=this.extensions,n=i.materials[e];let r;const a={},o=n.extensions||{},h=[];if(o[w.KHR_MATERIALS_UNLIT]){const c=s[w.KHR_MATERIALS_UNLIT];r=c.getMaterialType(),h.push(c.extendParams(a,n,t))}else{const c=n.pbrMetallicRoughness||{};if(a.color=new C(1,1,1),a.opacity=1,Array.isArray(c.baseColorFactor)){const d=c.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}c.baseColorTexture!==void 0&&h.push(t.assignTexture(a,"map",c.baseColorTexture,D)),a.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,a.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(a,"metalnessMap",c.metallicRoughnessTexture)),h.push(t.assignTexture(a,"roughnessMap",c.metallicRoughnessTexture))),r=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}n.doubleSided===!0&&(a.side=it);const l=n.alphaMode||ee.OPAQUE;if(l===ee.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===ee.MASK&&(a.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&r!==U&&(h.push(t.assignTexture(a,"normalMap",n.normalTexture)),a.normalScale=new Le(1,1),n.normalTexture.scale!==void 0)){const c=n.normalTexture.scale;a.normalScale.set(c,c)}return n.occlusionTexture!==void 0&&r!==U&&(h.push(t.assignTexture(a,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&r!==U&&(a.emissive=new C().fromArray(n.emissiveFactor)),n.emissiveTexture!==void 0&&r!==U&&h.push(t.assignTexture(a,"emissiveMap",n.emissiveTexture,D)),Promise.all(h).then(function(){const c=new r(a);return n.name&&(c.name=n.name),P(c,n),t.associations.set(c,{materials:e}),n.extensions&&$(s,c,n),c})}createUniqueName(e){const t=st.sanitizeNodeName(e||"");let i=t;for(let s=1;this.nodeNamesUsed[i];++s)i=t+"_"+s;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function n(a){return i[w.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(o){return xe(o,a,t)})}const r=[];for(let a=0,o=e.length;a<o;a++){const h=e[a],l=ri(h),c=s[l];if(c)r.push(c.promise);else{let d;h.extensions&&h.extensions[w.KHR_DRACO_MESH_COMPRESSION]?d=n(h):d=xe(new Ie,h,t),s[l]={primitive:h,promise:d},r.push(d)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,s=this.extensions,n=i.meshes[e],r=n.primitives,a=[];for(let o=0,h=r.length;o<h;o++){const l=r[o].material===void 0?ii(this.cache):this.getDependency("material",r[o].material);a.push(l)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(o){const h=o.slice(0,o.length-1),l=o[o.length-1],c=[];for(let p=0,m=l.length;p<m;p++){const y=l[p],f=r[p];let g;const x=h[p];if(f.mode===M.TRIANGLES||f.mode===M.TRIANGLE_STRIP||f.mode===M.TRIANGLE_FAN||f.mode===void 0)g=n.isSkinnedMesh===!0?new nt(y,x):new Oe(y,x),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),f.mode===M.TRIANGLE_STRIP?g.geometry=ge(g.geometry,Me):f.mode===M.TRIANGLE_FAN&&(g.geometry=ge(g.geometry,se));else if(f.mode===M.LINES)g=new rt(y,x);else if(f.mode===M.LINE_STRIP)g=new ot(y,x);else if(f.mode===M.LINE_LOOP)g=new at(y,x);else if(f.mode===M.POINTS)g=new lt(y,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);Object.keys(g.geometry.morphAttributes).length>0&&ni(g,n),g.name=t.createUniqueName(n.name||"mesh_"+e),P(g,n),f.extensions&&$(s,g,f),t.assignFinalMaterial(g),c.push(g)}for(let p=0,m=c.length;p<m;p++)t.associations.set(c[p],{meshes:e,primitives:p});if(c.length===1)return c[0];const d=new Q;t.associations.set(d,{meshes:e});for(let p=0,m=c.length;p<m;p++)d.add(c[p]);return d})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new oe(ae.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new ht(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),P(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,n=t.joints.length;s<n;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const n=s.pop(),r=s,a=[],o=[];for(let h=0,l=r.length;h<l;h++){const c=r[h];if(c){a.push(c);const d=new X;n!==null&&d.fromArray(n.array,h*16),o.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new ct(a,o)})}loadAnimation(e){const i=this.json.animations[e],s=i.name?i.name:"animation_"+e,n=[],r=[],a=[],o=[],h=[];for(let l=0,c=i.channels.length;l<c;l++){const d=i.channels[l],p=i.samplers[d.sampler],m=d.target,y=m.node,f=i.parameters!==void 0?i.parameters[p.input]:p.input,g=i.parameters!==void 0?i.parameters[p.output]:p.output;m.node!==void 0&&(n.push(this.getDependency("node",y)),r.push(this.getDependency("accessor",f)),a.push(this.getDependency("accessor",g)),o.push(p),h.push(m))}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(h)]).then(function(l){const c=l[0],d=l[1],p=l[2],m=l[3],y=l[4],f=[];for(let g=0,x=c.length;g<x;g++){const b=c[g],T=d[g],I=p[g],v=m[g],_=y[g];if(b===void 0)continue;b.updateMatrix();let S;switch(R[_.path]){case R.weights:S=gt;break;case R.rotation:S=me;break;case R.position:case R.scale:default:S=mt;break}const N=b.name?b.name:b.uuid,Be=v.interpolation!==void 0?ti[v.interpolation]:Ne,W=[];R[_.path]===R.weights?b.traverse(function(L){L.morphTargetInfluences&&W.push(L.name?L.name:L.uuid)}):W.push(N);let F=I.array;if(I.normalized){const L=he(F.constructor),K=new Float32Array(F.length);for(let k=0,ue=F.length;k<ue;k++)K[k]=F[k]*L;F=K}for(let L=0,K=W.length;L<K;L++){const k=new S(W[L]+"."+R[_.path],T.array,F,Be);v.interpolation==="CUBICSPLINE"&&(k.createInterpolant=function(ze){const $e=this instanceof me?ei:Ge;return new $e(this.times,this.values,this.getValueSize()/3,ze)},k.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),f.push(k)}}return new ut(s,void 0,f)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(n){const r=i._getNodeRef(i.meshCache,s.mesh,n);return s.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let o=0,h=s.weights.length;o<h;o++)a.morphTargetInfluences[o]=s.weights[o]}),r})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],n=i._loadNodeShallow(e),r=[],a=s.children||[];for(let h=0,l=a.length;h<l;h++)r.push(i.getDependency("node",a[h]));const o=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([n,Promise.all(r),o]).then(function(h){const l=h[0],c=h[1],d=h[2];d!==null&&l.traverse(function(p){p.isSkinnedMesh&&p.bind(d,ai)});for(let p=0,m=c.length;p<m;p++)l.add(c[p]);return l})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const n=t.nodes[e],r=n.name?s.createUniqueName(n.name):"",a=[],o=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return o&&a.push(o),n.camera!==void 0&&a.push(s.getDependency("camera",n.camera).then(function(h){return s._getNodeRef(s.cameraCache,n.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){a.push(h)}),this.nodeCache[e]=Promise.all(a).then(function(h){let l;if(n.isBone===!0?l=new pt:h.length>1?l=new Q:h.length===1?l=h[0]:l=new Se,l!==h[0])for(let c=0,d=h.length;c<d;c++)l.add(h[c]);if(n.name&&(l.userData.name=n.name,l.name=r),P(l,n),n.extensions&&$(i,l,n),n.matrix!==void 0){const c=new X;c.fromArray(n.matrix),l.applyMatrix4(c)}else n.translation!==void 0&&l.position.fromArray(n.translation),n.rotation!==void 0&&l.quaternion.fromArray(n.rotation),n.scale!==void 0&&l.scale.fromArray(n.scale);return s.associations.has(l)||s.associations.set(l,{}),s.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,n=new Q;i.name&&(n.name=s.createUniqueName(i.name)),P(n,i),i.extensions&&$(t,n,i);const r=i.nodes||[],a=[];for(let o=0,h=r.length;o<h;o++)a.push(s.getDependency("node",r[o]));return Promise.all(a).then(function(o){for(let l=0,c=o.length;l<c;l++)n.add(o[l]);const h=l=>{const c=new Map;for(const[d,p]of s.associations)(d instanceof J||d instanceof fe)&&c.set(d,p);return l.traverse(d=>{const p=s.associations.get(d);p!=null&&c.set(d,p)}),c};return s.associations=h(n),n})}}function hi(u,e,t){const i=e.attributes,s=new H;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],o=a.min,h=a.max;if(o!==void 0&&h!==void 0){if(s.set(new A(o[0],o[1],o[2]),new A(h[0],h[1],h[2])),a.normalized){const l=he(G[a.componentType]);s.min.multiplyScalar(l),s.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const n=e.targets;if(n!==void 0){const a=new A,o=new A;for(let h=0,l=n.length;h<l;h++){const c=n[h];if(c.POSITION!==void 0){const d=t.json.accessors[c.POSITION],p=d.min,m=d.max;if(p!==void 0&&m!==void 0){if(o.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),o.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),o.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),d.normalized){const y=he(G[d.componentType]);o.multiplyScalar(y)}a.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}u.boundingBox=s;const r=new wt;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,u.boundingSphere=r}function xe(u,e,t){const i=e.attributes,s=[];function n(r,a){return t.getDependency("accessor",r).then(function(o){u.setAttribute(a,o)})}for(const r in i){const a=le[r]||r.toLowerCase();a in u.attributes||s.push(n(i[r],a))}if(e.indices!==void 0&&!u.index){const r=t.getDependency("accessor",e.indices).then(function(a){u.setIndex(a)});s.push(r)}return P(u,e),hi(u,e,t),Promise.all(s).then(function(){return e.targets!==void 0?si(u,e.targets,t):u})}const te=new WeakMap;class ci extends ve{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const n=new Y(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,r=>{this.parse(r,t,s)},i,s)}parse(e,t,i){this.decodeDracoFile(e,t,null,null,D).catch(i)}decodeDracoFile(e,t,i,s,n=bt){const r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:n};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){const i=JSON.stringify(t);if(te.has(e)){const o=te.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const n=this.workerNextTaskID++,r=e.byteLength,a=this._getWorker(n,r).then(o=>(s=o,new Promise((h,l)=>{s._callbacks[n]={resolve:h,reject:l},s.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{s&&n&&this._releaseTask(s,n)}),te.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new Ie;e.index&&t.setIndex(new j(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],n=s.name,r=s.array,a=s.itemSize,o=new j(r,a);n==="color"&&this._assignVertexColorSpace(o,s.vertexColorSpace),t.setAttribute(n,o)}return t}_assignVertexColorSpace(e,t){if(t!==D)return;const i=new C;for(let s=0,n=e.count;s<n;s++)i.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Y(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,n)=>{i.load(e,s,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const n=di.toString(),r=["/* draco decoder */",s,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(n){const r=n.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,n){return s._taskLoad>n._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function di(){let u,e;onmessage=function(r){const a=r.data;switch(a.type){case"init":u=a.decoderConfig,e=new Promise(function(l){u.onModuleLoaded=function(c){l({draco:c})},DracoDecoderModule(u)});break;case"decode":const o=a.buffer,h=a.taskConfig;e.then(l=>{const c=l.draco,d=new c.Decoder;try{const p=t(c,d,new Int8Array(o),h),m=p.attributes.map(y=>y.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{c.destroy(d)}});break}};function t(r,a,o,h){const l=h.attributeIDs,c=h.attributeTypes;let d,p;const m=a.GetEncodedGeometryType(o);if(m===r.TRIANGULAR_MESH)d=new r.Mesh,p=a.DecodeArrayToMesh(o,o.byteLength,d);else if(m===r.POINT_CLOUD)d=new r.PointCloud,p=a.DecodeArrayToPointCloud(o,o.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const y={index:null,attributes:[]};for(const f in l){const g=self[c[f]];let x,b;if(h.useUniqueIDs)b=l[f],x=a.GetAttributeByUniqueId(d,b);else{if(b=a.GetAttributeId(d,r[l[f]]),b===-1)continue;x=a.GetAttribute(d,b)}const T=s(r,a,d,f,g,x);f==="color"&&(T.vertexColorSpace=h.vertexColorSpace),y.attributes.push(T)}return m===r.TRIANGULAR_MESH&&(y.index=i(r,a,d)),r.destroy(d),y}function i(r,a,o){const l=o.num_faces()*3,c=l*4,d=r._malloc(c);a.GetTrianglesUInt32Array(o,c,d);const p=new Uint32Array(r.HEAPF32.buffer,d,l).slice();return r._free(d),{array:p,itemSize:1}}function s(r,a,o,h,l,c){const d=c.num_components(),m=o.num_points()*d,y=m*l.BYTES_PER_ELEMENT,f=n(r,l),g=r._malloc(y);a.GetAttributeDataArrayForAllPoints(o,c,f,y,g);const x=new l(r.HEAPF32.buffer,g,m).slice();return r._free(g),{name:h,array:x,itemSize:d}}function n(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}class ui{constructor(){this.loadingManager=new xt,this.textureLoader=new ke(this.loadingManager),this.gltfLoader=new Pt(this.loadingManager);const e=new ci;e.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),e.setDecoderConfig({type:"js"}),this.gltfLoader.setDRACOLoader(e)}loadGLB(e){return new Promise((t,i)=>{if(!e){i(new Error("Invalid path provided"));return}this.gltfLoader.load(e,s=>{if(!s.scene){i(new Error("Loaded GLTF has no scene property"));return}t(s)},s=>{console.log(`Loading ${e}: ${(s.loaded/s.total*100).toFixed(1)}%`)},s=>{console.error("GLB Load Error:",s),i(s)})})}}/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class E{constructor(e,t,i,s,n="div"){this.parent=e,this.object=t,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(s),this.$name=document.createElement("div"),this.$name.classList.add("name"),E.nextNameID=E.nextNameID||0,this.$name.id="lil-gui-name-"+ ++E.nextNameID,this.$widget=document.createElement(n),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class pi extends E{constructor(e,t,i){super(e,t,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function ce(u){let e,t;return(e=u.match(/(#|0x)?([a-f0-9]{6})/i))?t=e[2]:(e=u.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?t=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=u.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!t&&"#"+t}const fi={isPrimitive:!0,match:u=>typeof u=="string",fromHexString:ce,toHexString:ce},V={isPrimitive:!0,match:u=>typeof u=="number",fromHexString:u=>parseInt(u.substring(1),16),toHexString:u=>"#"+u.toString(16).padStart(6,0)},mi={isPrimitive:!1,match:Array.isArray,fromHexString(u,e,t=1){const i=V.fromHexString(u);e[0]=(i>>16&255)/255*t,e[1]=(i>>8&255)/255*t,e[2]=(255&i)/255*t},toHexString:([u,e,t],i=1)=>V.toHexString(u*(i=255/i)<<16^e*i<<8^t*i<<0)},gi={isPrimitive:!1,match:u=>Object(u)===u,fromHexString(u,e,t=1){const i=V.fromHexString(u);e.r=(i>>16&255)/255*t,e.g=(i>>8&255)/255*t,e.b=(255&i)/255*t},toHexString:({r:u,g:e,b:t},i=1)=>V.toHexString(u*(i=255/i)<<16^e*i<<8^t*i<<0)},yi=[fi,V,mi,gi];class Ai extends E{constructor(e,t,i,s){var n;super(e,t,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(n=this.initialValue,yi.find(r=>r.match(n))),this._rgbScale=s,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const r=ce(this.$text.value);r&&this._setValueFromHexString(r)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class ie extends E{constructor(e,t,i){super(e,t,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",s=>{s.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class wi extends E{constructor(e,t,i,s,n,r){super(e,t,i,"number"),this._initInput(),this.min(s),this.max(n);const a=r!==void 0;this.step(a?r:this._getImplicitStep(),a),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=100*t+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=l=>{const c=parseFloat(this.$input.value);isNaN(c)||(this._snapClampSetValue(c+l),this.$input.value=this.getValue())};let t,i,s,n,r,a=!1;const o=l=>{if(a){const c=l.clientX-t,d=l.clientY-i;Math.abs(d)>5?(l.preventDefault(),this.$input.blur(),a=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(c)>5&&h()}if(!a){const c=l.clientY-s;r-=c*this._step*this._arrowKeyMultiplier(l),n+r>this._max?r=this._max-n:n+r<this._min&&(r=this._min-n),this._snapClampSetValue(n+r)}s=l.clientY},h=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",h)};this.$input.addEventListener("input",()=>{let l=parseFloat(this.$input.value);isNaN(l)||(this._stepExplicit&&(l=this._snap(l)),this.setValue(this._clamp(l)))}),this.$input.addEventListener("keydown",l=>{l.code==="Enter"&&this.$input.blur(),l.code==="ArrowUp"&&(l.preventDefault(),e(this._step*this._arrowKeyMultiplier(l))),l.code==="ArrowDown"&&(l.preventDefault(),e(this._step*this._arrowKeyMultiplier(l)*-1))}),this.$input.addEventListener("wheel",l=>{this._inputFocused&&(l.preventDefault(),e(this._step*this._normalizeMouseWheel(l)))},{passive:!1}),this.$input.addEventListener("mousedown",l=>{t=l.clientX,i=s=l.clientY,a=!0,n=this.getValue(),r=0,window.addEventListener("mousemove",o),window.addEventListener("mouseup",h)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=d=>{const p=this.$slider.getBoundingClientRect();let m=(y=d,f=p.left,g=p.right,x=this._min,b=this._max,(y-f)/(g-f)*(b-x)+x);var y,f,g,x,b;this._snapClampSetValue(m)},t=d=>{e(d.clientX)},i=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i)};let s,n,r=!1;const a=d=>{d.preventDefault(),this._setDraggingStyle(!0),e(d.touches[0].clientX),r=!1},o=d=>{if(r){const p=d.touches[0].clientX-s,m=d.touches[0].clientY-n;Math.abs(p)>Math.abs(m)?a(d):(window.removeEventListener("touchmove",o),window.removeEventListener("touchend",h))}else d.preventDefault(),e(d.touches[0].clientX)},h=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",h)},l=this._callOnFinishChange.bind(this);let c;this.$slider.addEventListener("mousedown",d=>{this._setDraggingStyle(!0),e(d.clientX),window.addEventListener("mousemove",t),window.addEventListener("mouseup",i)}),this.$slider.addEventListener("touchstart",d=>{d.touches.length>1||(this._hasScrollBar?(s=d.touches[0].clientX,n=d.touches[0].clientY,r=!0):a(d),window.addEventListener("touchmove",o,{passive:!1}),window.addEventListener("touchend",h))},{passive:!1}),this.$slider.addEventListener("wheel",d=>{if(Math.abs(d.deltaX)<Math.abs(d.deltaY)&&this._hasScrollBar)return;d.preventDefault();const p=this._normalizeMouseWheel(d)*this._step;this._snapClampSetValue(this.getValue()+p),this.$input.value=this.getValue(),clearTimeout(c),c=setTimeout(l,400)},{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle("lil-gui-"+t,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:i}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,i=-e.wheelDelta/120,i*=this._stepExplicit?1:10),t+-i}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){const t=Math.round(e/this._step)*this._step;return parseFloat(t.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class bi extends E{constructor(e,t,i,s){super(e,t,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(s)?s:Object.values(s),this._names=Array.isArray(s)?s:Object.keys(s),this._names.forEach(n=>{const r=document.createElement("option");r.innerHTML=n,this.$select.appendChild(r)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.innerHTML=t===-1?e:this._names[t],this}}class xi extends E{constructor(e,t,i){super(e,t,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",s=>{s.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Te=!1;class de{constructor({parent:e,autoPlace:t=e===void 0,container:i,width:s,title:n="Controls",injectStyles:r=!0,touchStyles:a=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",o=>{o.code!=="Enter"&&o.code!=="Space"||(o.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(n),a&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Te&&r&&(function(o){const h=document.createElement("style");h.innerHTML=o;const l=document.querySelector("head link[rel=stylesheet], head style");l?document.head.insertBefore(h,l):document.head.appendChild(h)}('.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:""}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}'),Te=!0),i?i.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),s&&this.domElement.style.setProperty("--width",s+"px"),this.domElement.addEventListener("keydown",o=>o.stopPropagation()),this.domElement.addEventListener("keyup",o=>o.stopPropagation())}add(e,t,i,s,n){if(Object(i)===i)return new bi(this,e,t,i);const r=e[t];switch(typeof r){case"number":return new wi(this,e,t,i,s,n);case"boolean":return new pi(this,e,t);case"string":return new xi(this,e,t);case"function":return new ie(this,e,t)}console.error(`gui.add failed
	property:`,t,`
	object:`,e,`
	value:`,r)}addColor(e,t,i=1){return new Ai(this,e,t,i)}addFolder(e){return new de({parent:this,title:e})}load(e,t=!0){return e.controllers&&this.controllers.forEach(i=>{i instanceof ie||i._name in e.controllers&&i.load(e.controllers[i._name])}),t&&e.folders&&this.folders.forEach(i=>{i._title in e.folders&&i.load(e.folders[i._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(i=>{if(!(i instanceof ie)){if(i._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${i._name}"`);t.controllers[i._name]=i.save()}}),e&&this.folders.forEach(i=>{if(i._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${i._title}"`);t.folders[i._title]=i.save()}),t}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");const i=n=>{n.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const s=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=s+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(t=>t.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}class Ti{constructor(){this.keys={forward:!1,backward:!1,left:!1,right:!1,space:!1,shift:!1,quit:!1},this.cameraRotation={left:!1,right:!1,up:!1,down:!1},this._Initialize()}_Initialize(){document.addEventListener("keydown",e=>this._onKeyDown(e),!1),document.addEventListener("keyup",e=>this._onKeyUp(e),!1)}_onKeyDown(e){switch(e.key.toLowerCase()){case"w":this.keys.forward=!0;break;case"a":this.keys.left=!0;break;case"s":this.keys.backward=!0;break;case"d":this.keys.right=!0;break;case" ":this.keys.space=!0;break;case"shift":this.keys.shift=!0;break;case"q":this.keys.quit=!0;break;case"arrowright":this.cameraRotation.left=!0;break;case"arrowleft":this.cameraRotation.right=!0;break;case"arrowup":this.cameraRotation.up=!0;break;case"arrowdown":this.cameraRotation.down=!0;break}}_onKeyUp(e){switch(e.key.toLowerCase()){case"w":this.keys.forward=!1;break;case"a":this.keys.left=!1;break;case"s":this.keys.backward=!1;break;case"d":this.keys.right=!1;break;case" ":this.keys.space=!1;break;case"shift":this.keys.shift=!1;break;case"q":this.keys.quit=!1;break;case"arrowright":this.cameraRotation.left=!1;break;case"arrowleft":this.cameraRotation.right=!1;break;case"arrowup":this.cameraRotation.up=!1;break;case"arrowdown":this.cameraRotation.down=!1;break}}resetMovementKeys(){console.log("Resetting movement keys in InputController."),this.keys.forward=!1,this.keys.backward=!1,this.keys.left=!1,this.keys.right=!1}}class _i{constructor(e){this.params=e,this.camera=e.camera,this.target=e.target,this.idealOffsetLocal=new A(0,150,-15e3),this.idealLookAtLocal=new A(0,50,100),this.currentPosition=new A,this.currentLookAt=new A,this.phi=e.phi||Math.PI/6,this.theta=e.theta||0,this.radius=this.idealOffsetLocal.length(),this.rotationSpeed=e.cameraRotateSpeed||1.5,this.phiSpeed=e.cameraRotateSpeed||1.5,this.phiClamp={min:-Math.PI/10,max:Math.PI/3},this._UpdateCamera()}_CalculateIdealOffset(){const e=this.idealOffsetLocal.clone(),t=new B().setFromAxisAngle(new A(0,1,0),this.theta);return e.applyQuaternion(t),e.add(this.target.position),e}_CalculateIdealLookat(){const e=this.idealLookAtLocal.clone(),t=new B().setFromAxisAngle(new A(0,1,0),this.theta);return e.applyQuaternion(t),e.add(this.target.position),e}_UpdateCamera(){const e=this._CalculateIdealOffset(),t=this._CalculateIdealLookat();this.currentPosition.copy(e),this.currentLookAt.copy(t),this.camera.position.copy(this.currentPosition),this.camera.lookAt(this.currentLookAt)}Update(e,t){if(this.params.freezeMovement)return this.theta;t.cameraRotation.left&&(this.theta+=this.rotationSpeed*e),t.cameraRotation.right&&(this.theta-=this.rotationSpeed*e),t.cameraRotation.up&&(this.phi=Math.min(this.phiClamp.max,this.phi+this.phiSpeed*e),this.idealOffsetLocal.x=0,this.idealOffsetLocal.y=this.radius*Math.sin(this.phi),this.idealOffsetLocal.z=-this.radius*Math.cos(this.phi)),t.cameraRotation.down&&(this.phi=Math.max(this.phiClamp.min,this.phi-this.phiSpeed*e),this.idealOffsetLocal.x=0,this.idealOffsetLocal.y=this.radius*Math.sin(this.phi),this.idealOffsetLocal.z=-this.radius*Math.cos(this.phi));const i=this._CalculateIdealOffset(),s=this._CalculateIdealLookat();return this.camera.position.copy(i),this.camera.lookAt(s),this.theta}}class Mi{constructor(e){this.params=e,this.model=e.model,this.scene=e.scene,this.collisionMeshes=e.collisionMeshes||[],this.audioLoader=e.audioLoader,this.listener=e.listener,this.isMuted=e.isMuted,this.coordinateOffset=e.coordinateOffset,this.gravity=e.gravity||-5e4,this.velocityY=0,this.isGrounded=!1,this.hoverHeight=e.hoverHeight||10,this.movementSpeed=800,this.movementSpeedMultiplier=e.movementSpeedMultiplier||10,this.runMultiplier=2,this.isJumping=!1,this.jumpStartTime=0,this.jumpDuration=1,this.initialJumpY=0,this.playerHeight=e.playerHeight||0,this.playerHalfWidth=e.playerHalfWidth||5,this.playerHalfDepth=e.playerHalfDepth||5,this.raycaster=new Fe,this.currentCollisionMesh=null,this.setupAudio(),this.isWalking=!1}setupAudio(){!this.audioLoader||!this.listener||(this.walkSound=this.params.walkSound||new q(this.listener),this.jumpSound=this.params.jumpSound||new q(this.listener),this.walkSound&&!this.walkSound.buffer&&this.audioLoader&&this.audioLoader.load("./audio/caminata.mp3",e=>{this.walkSound.setBuffer(e),this.walkSound.setLoop(!0),this.walkSound.setVolume(this.isMuted?0:10)}),this.jumpSound&&!this.jumpSound.buffer&&this.audioLoader&&this.audioLoader.load("./audio/salto.mp3",e=>{this.jumpSound.setBuffer(e),this.jumpSound.setVolume(this.isMuted?0:.5)}))}_HandleJump(e,t){if(t.keys.space&&this.isGrounded&&!this.isJumping&&(this.isJumping=!0,this.jumpStartTime=performance.now(),this.initialJumpY=this.model.position.y,this.isGrounded=!1,!this.isMuted&&this.jumpSound&&(this.jumpSound.isPlaying&&this.jumpSound.stop(),this.jumpSound.play())),this.isJumping){const s=(performance.now()-this.jumpStartTime)/1e3/this.jumpDuration;if(s<1){const r=this.initialJumpY+3e3*Math.sin(s*Math.PI);this.model.position.y=r}else this.isJumping=!1}}_CheckGrounded(){if(!this.model||!this.collisionMeshes||this.collisionMeshes.length===0)return this.isGrounded=!1,this.currentCollisionMesh=null,!1;const e=this.model.position.clone(),t=this.playerHalfWidth*.8,i=this.playerHalfDepth*.8,s=this.playerHeight*.1,n=this.playerHeight*.5+this.hoverHeight+100;this.raycaster.far=n;const r=[new A(e.x,e.y+s,e.z),new A(e.x+t,e.y+s,e.z+i),new A(e.x-t,e.y+s,e.z+i),new A(e.x+t,e.y+s,e.z-i),new A(e.x-t,e.y+s,e.z-i)];let a=-1/0,o=null;const h=this.collisionMeshes.filter(l=>l!==this.model);for(const l of r){this.raycaster.set(l,new A(0,-1,0));const c=this.raycaster.intersectObjects(h,!0);if(c.length>0)for(const d of c)d.point.y<l.y&&d.point.y>a&&(a=d.point.y,o=d.object)}if(a!==-1/0){const l=a+this.hoverHeight,c=this.hoverHeight*1.5;return!this.isJumping&&Math.abs(this.model.position.y-l)<c?(!this.isGrounded&&this.velocityY<0?(this.model.position.y=l,this.velocityY=0):this.model.position.y<l&&(this.model.position.y=l),this.isGrounded=!0):!this.isJumping&&this.model.position.y>l&&this.velocityY<=0?this.isGrounded=!1:!this.isJumping&&this.model.position.y<l?this.isGrounded=!1:this.isGrounded=!1,this.currentCollisionMesh=o,this.isGrounded}else return this.isGrounded=!1,this.currentCollisionMesh=null,!1}_ApplyGravity(e){!this.isGrounded&&!this.isJumping&&(this.velocityY+=this.gravity*e,this.velocityY=Math.max(this.velocityY,-2e4),this.model.position.y+=this.velocityY*e,this.model.position.y<=-16e3&&this.coordinateOffset&&(this.model.position.copy(this.coordinateOffset),this.velocityY=0,this.isGrounded=!0))}_HandleMovement(e,t,i){if(!this.model)return;this.model.rotation.y=i;const s=new A(Math.sin(i),0,Math.cos(i)),n=new A(Math.sin(i+Math.PI/2),0,Math.cos(i+Math.PI/2)),r=t.keys.shift?this.runMultiplier:1,a=this.movementSpeed*this.movementSpeedMultiplier*e*r;let o=!1;return t.keys.forward&&(this.model.position.x+=s.x*a,this.model.position.z+=s.z*a,o=!0),t.keys.backward&&(this.model.position.x-=s.x*a,this.model.position.z-=s.z*a,o=!0),t.keys.left&&(this.model.position.x+=n.x*a,this.model.position.z+=n.z*a,o=!0),t.keys.right&&(this.model.position.x-=n.x*a,this.model.position.z-=n.z*a,o=!0),this._UpdateWalkingSound(o),o}_UpdateWalkingSound(e){!this.walkSound||this.isMuted||(e&&this.isGrounded&&!this.isWalking?(this.isWalking=!0,this.walkSound.isPlaying||(this.walkSound.play(),this.walkSound.setVolume(10))):(!e||!this.isGrounded)&&this.isWalking&&(this.isWalking=!1,this.walkSound.isPlaying&&this.walkSound.stop()))}Update(e,t,i){if(this.params.freezeMovement)return this._UpdateWalkingSound(!1),{isMoving:!1,isGrounded:this.isGrounded,position:this.model.position,currentCollisionMesh:this.currentCollisionMesh};this._CheckGrounded(),this._HandleJump(e,t);const s=this._HandleMovement(e,t,i);return this.isJumping||this._ApplyGravity(e),{isMoving:s,isGrounded:this.isGrounded,position:this.model.position,currentCollisionMesh:this.currentCollisionMesh}}}class vi{constructor(e=!1){this.isMuted=e,this.initialized=!1,this.freezeMovement=!1,this.untexturedMeshes=[],this.untexturedWarningShown=!1,this.frozenByUntexturedWarning=!1,this.tempBox=new H,this.playerBox=new H,this.collisionMeshes=[],this.currentLevelPath=null,this.isDyingPhase1=!1,this.isMovingCameraToCenital=!1,this.isWaitingForDeathReload=!1,this.deathAnimationTimer=0,this.deathAnimationDuration=1.5,this.cenitalCameraAnimationTimer=0,this.cenitalCameraAnimationDuration=1.5,this.deathDelayTimer=0,this.deathDelayDuration=3,this.initialDeathPlayerPosition=new A,this.initialDeathXRotation=0,this.targetDeathXRotation=0,this.targetDeathYPosition=0,this.initialCameraPosition=new A,this.targetCameraPositionPhase1=new A,this.finalPlayerPosition=new A,this.initialCameraCenitalPosition=new A,this.targetCameraCenitalPosition=new A,this.initialCameraCenitalQuaternion=new B,this.targetCameraCenitalQuaternion=new B,this.isPreTeleportLock=!1,this.preTeleportLockTimer=0,this.preTeleportLockDuration=1,this.nextLevelPath=null,this.columpioMesh=null,this.chestVelocityY=0,this.isChestGrounded=!1,this.chestRaycaster=new Fe,this.chestGravity=-5e4,this.chestHoverHeight=5,this.starYOffset=1e3,this.time=0,this.clock=new Tt,this.renderer=new Rt,this.scene=new _t,this.camera=new oe(45,window.innerWidth/window.innerHeight,.1,5e6),this.modelCenter=new A(0,-5,0),this.audioLoader=new Mt,this.listener=new vt,this.camera.add(this.listener),this.theta=0,this.phi=0,this.radius=350,this.cameraRotateSpeed=1.5,this.coordDisplay=this._createCoordinateDisplay(),this.chestMessage=this._createChestMessage(),this._initializeGame(),window.addEventListener("resize",()=>this._onWindowResize(),!1)}async _initializeGame(){try{this._setupInput(),this.assetLoader=new ui;const[e,t]=await Promise.all([this.assetLoader.loadGLB("./models/newproject.glb"),this.assetLoader.loadGLB("./models/chest.glb")]);this._setupPlayer(e.scene),this._setupChest(t.scene),await this._loadLevel("./models/juegomapa334433.glb"),this._initializeCharacterController(),this._initializeCamera(),this._setupAudio(),this._setupGUI(),this.initialized=!0,this._startGameLoop();const i=document.getElementById("loading-screen");i&&(i.style.display="none")}catch(e){console.error("Error initializing game:",e)}}async _loadLevel(e){console.log(`Loading level: ${e}`),this.currentLevelPath=e,this.freezeMovement=!0;try{this.baseModel&&this.scene.remove(this.baseModel);const t=await this.assetLoader.loadGLB(e);this.baseModel=t.scene,this._setupLevelScene(this.baseModel),this._resetPlayerPosition(this.baseModel),this.character&&(this.character.coordinateOffset.copy(this.playerModel.position),this.character.collisionMeshes=this.collisionMeshes),t.animations&&t.animations.length>0?this._setupAnimations(t):this.mixer&&(this.mixer.stopAllAction(),this.mixer=null),console.log(`Level ${e} loaded successfully.`)}catch(t){throw console.error(`Error loading level ${e}:`,t),t}finally{!this.isTeleportingFreeze&&!this.isDyingPhase1&&(this.freezeMovement=!1),console.log("Movement frozen status after level load attempt:",this.freezeMovement)}}_setupPlayer(e){this.playerModel=e,e.scale.set(3e3,3e3,3e3),this.scene.add(e),e.updateMatrixWorld(!0);const t=new H().setFromObject(e);this.playerHeight=t.max.y-t.min.y,this.playerHalfWidth=(t.max.x-t.min.x)/2,this.playerHalfDepth=(t.max.z-t.min.z)/2,this.coordinateOffset=new A}_setupChest(e){this.chestModel=e,e.scale.set(500,500,500),this.scene.add(e),this._createStar(new A)}_resetPlayerPosition(e){let t=new A(0,5e3,0);const i=e.getObjectByName("piso");if(console.log(`Resetting player position for level: ${this.currentLevelPath}`),i){const s=new A;i.getWorldPosition(s);const n=new H().setFromObject(i),r=n.max.y;if(this.currentLevelPath.endsWith("juegomapa334433.glb")){console.log("Setting spawn for juegomapa334433.glb to piso center.");const a=new A;n.getCenter(a),t.set(a.x,r+100,a.z)}else this.currentLevelPath.endsWith("nivel1.glb")?(console.log("Setting spawn for nivel1.glb"),t.set(s.x+5e3,r+100,s.z-1e4)):(console.warn(`Unknown level path for spawn: ${this.currentLevelPath}. Using default offset.`),t.set(s.x,r+100,s.z));console.log("Player spawn point calculated:",t)}else console.warn("'piso' mesh not found in the new level. Using default world origin spawn point."),t.set(0,5e3,0);if(this.playerModel&&(this.playerModel.position.copy(t),this.playerModel.rotation.set(0,0,0),this.playerModel.updateMatrixWorld(!0),this.coordinateOffset.copy(t),console.log("Player position reset to:",this.playerModel.position)),this.character&&(this.character.velocityY=0,this.character.isGrounded=!1,this.character.isJumping=!1),this.cameraController&&(this.cameraController.theta=0,this.cameraController._UpdateCamera()),this.chestModel&&i){const s=new A;i.getWorldPosition(s);const r=new H().setFromObject(i).max.y;let a=new A;if(this.currentLevelPath.endsWith("juegomapa334433.glb")){const o=new A(1e4,0,5e3);a.copy(t).add(o),a.y=r+100}else this.currentLevelPath.endsWith("nivel1.glb")?a.set(t.x+1e4,r+100,t.z):a.copy(t).add(new A(5e3,0,0));this.chestModel.position.copy(a),this.chestModel.rotation.y=-Math.PI/6,this.chestVelocityY=0,this.isChestGrounded=!1,console.log("Chest position reset relative to level:",this.chestModel.position)}else this.chestModel&&(console.warn("'piso' not found, cannot accurately reposition chest. Placing near player."),this.chestModel.position.copy(t).add(new A(5e3,0,0)),this.chestVelocityY=0,this.isChestGrounded=!1);this._updateStarAndLightPosition()}_setupLevelScene(e){this.untexturedMeshes=[],this.collisionMeshes=[],this.planeMesh=null,this.cube010Mesh=null,this.columpioMesh=null,e.scale.set(300,300,300),e.position.set(0,-5,0),e.rotation.set(0,Math.PI/4,0),this.scene.add(e),console.log("--- Traversing New Level Scene Meshes ---"),e.traverse(t=>{if(t.isMesh){this.collisionMeshes.push(t),t.name==="piso"&&(this.planeMesh=t),t.name==="Cube010"&&(this.cube010Mesh=t),t.name==="columpio"&&(this.columpioMesh=t,console.log("Found 'columpio' mesh:",t)),t.castShadow=!0,t.receiveShadow=!0;const i=Array.isArray(t.material)?t.material:[t.material];let s=!1;for(const n of i)if(n&&n.map&&n.map.name==="notexturebro"){s=!0;break}s&&this.untexturedMeshes.push(t)}}),console.log(`--- Finished Traversing Level. Found ${this.collisionMeshes.length} potential collision meshes. ---`),this.planeMesh||console.warn("'piso' mesh not found in this level!"),this.columpioMesh||console.warn("'columpio' mesh not found in this level!"),this._setupLighting(),e.updateMatrixWorld(!0)}_createStar(e){const t=new Lt,i=5,s=20,n=40;t.moveTo(n,0);for(let h=0;h<2*i;h++){const l=h*Math.PI/i,c=h%2===0?n:s;t.lineTo(Math.cos(l)*c,Math.sin(l)*c)}t.closePath();const r={depth:1,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:5,bevelThickness:5},a=new Et(t,r),o=new Ct({color:16776960,specular:1118481,shininess:1e3});this.starMesh=new Oe(a,o),this.starMesh.scale.set(4,4,4),this.starMesh.position.copy(e),this.starMesh.rotation.y=-Math.PI/4,this.scene.add(this.starMesh),this.starLight=new Ee(16761949,10,1e4,2),this.starLight.position.copy(this.starMesh.position),this.starLight.castShadow=!0,this.scene.add(this.starLight),this.starRotationSpeed=1.5}_setupLighting(){const e=new St(16711935,.5),t=new Ce(16777215,1);t.position.set(50,100,-50),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.5,t.shadow.camera.far=5e5,t.shadow.camera.left=-1e5,t.shadow.camera.right=1e5,t.shadow.camera.top=1e5,t.shadow.camera.bottom=-1e5,this.scene.getObjectByName("ambientLight")||(e.name="ambientLight",this.scene.add(e)),this.scene.getObjectByName("directionalLight")||(t.name="directionalLight",this.scene.add(t)),this.renderer.instance.shadowMap.enabled=!0,this.renderer.instance.shadowMap.type=_e}_updateStarAndLightPosition(){this.starMesh&&this.chestModel&&this.starMesh.position.set(this.chestModel.position.x,this.chestModel.position.y+this.starYOffset,this.chestModel.position.z-400),this.starLight&&this.starMesh&&this.starLight.position.copy(this.starMesh.position)}_setupInput(){this.input=new Ti}_initializeCharacterController(){this.characterParams={model:this.playerModel,scene:this.scene,collisionMeshes:this.collisionMeshes,gravity:this.gravity||-5e4,audioLoader:this.audioLoader,listener:this.listener,isMuted:this.isMuted,walkSound:this.walkSound,jumpSound:this.jumpSound,playerHeight:this.playerHeight,playerHalfWidth:this.playerHalfWidth,playerHalfDepth:this.playerHalfDepth,coordinateOffset:this.coordinateOffset,movementSpeedMultiplier:this.movementSpeedMultiplier||15,hoverHeight:1050,freezeMovement:this.freezeMovement},this.character=new Mi(this.characterParams)}_initializeCamera(){this.cameraParams={camera:this.camera,target:this.playerModel,radius:this.radius,theta:this.theta,phi:this.phi,cameraRotateSpeed:this.cameraRotateSpeed,freezeMovement:this.freezeMovement},this.cameraController=new _i(this.cameraParams)}_setupAudio(){this.backgroundMusic=new q(this.listener),this.audioLoader.load("./audio/cancionprincipal.mp3",e=>{this.backgroundMusic.setBuffer(e),this.backgroundMusic.setLoop(!0),this.backgroundMusic.setVolume(this.isMuted?0:.5),this.isMuted||(this.backgroundMusic.play(),this.isMusicPlaying=!0)}),this.creepyAudio=new q(this.listener),this.audioLoader.load("./audio/pistacreepy.mp3",e=>{this.creepyAudio.setBuffer(e),this.creepyAudio.setLoop(!0),this.creepyAudio.setVolume(0)}),this.creepyDistance=1e4,this.isPlayingCreepy=!1}_setupAnimations(e){this.mixer=new kt(e.scene),e.animations.forEach(t=>{this.mixer.clipAction(t).play()})}_setupGUI(){new de().add(this.character,"movementSpeedMultiplier",.5,100).name("Speed Multiplier")}_startGameLoop(){const e=()=>{if(requestAnimationFrame(e),!this.initialized)return;let t=!1;this.isDyingPhase1||this.isMovingCameraToCenital||this.isWaitingForDeathReload||this.isPreTeleportLock||this.isTeleportingFreeze||this.frozenByUntexturedWarning?t=!0:t=this.freezeMovement,this.characterParams.freezeMovement=t,this.cameraParams.freezeMovement=t;const i=this.clock.getDelta();if(this.time+=i,this.playerModel&&!this.isDyingPhase1&&!this.isMovingCameraToCenital&&!this.isWaitingForDeathReload&&this.playerBox.setFromObject(this.playerModel,!0),this.isDyingPhase1){this._updateDeathAnimationPhase1(i),this.chestModel&&this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isMovingCameraToCenital){this._updateCenitalCameraAnimation(i),this.chestModel&&this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isWaitingForDeathReload){this._updateDeathDelay(i),this.chestModel&&this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isPreTeleportLock){this._updatePreTeleportLock(i),this.chestModel&&this._updateChestPhysics(i),this.mixer&&this.mixer.update(i),this.starMesh&&(this.starMesh.rotation.y+=this.starRotationSpeed*i),this._updateCoordinateDisplay(this.character.Update(0,this.input,this.cameraController.theta)),this.renderer.instance.render(this.scene,this.camera);return}else if(this.isTeleportingFreeze){this._updateTeleportFreeze(i),this.chestModel&&this._updateChestPhysics(i),this.renderer.instance.render(this.scene,this.camera);return}this.chestModel&&this._updateChestPhysics(i),this.mixer&&this.mixer.update(i),this.starMesh&&(this.starMesh.rotation.y+=this.starRotationSpeed*i);const s=this.cameraController.Update(i,this.input),n=this.character.Update(i,this.input,s);t||this.modelCenter.copy(this.playerModel.position),this._handleProximityEvents(),this._updateCoordinateDisplay(n),this.renderer.instance.render(this.scene,this.camera)};e()}_updatePreTeleportLock(e){this.preTeleportLockTimer+=e,console.log(`Pre-Teleport lock timer: ${this.preTeleportLockTimer.toFixed(2)} / ${this.preTeleportLockDuration}`),this.preTeleportLockTimer>=this.preTeleportLockDuration&&(console.log("Pre-Teleport lock finished. Starting Teleport Freeze phase."),this.isPreTeleportLock=!1,this.preTeleportLockTimer=0,this.isTeleportingFreeze=!0,this.teleportFreezeTimer=0)}_updateTeleportFreeze(e){if(this.teleportFreezeTimer+=e,this.teleportFreezeTimer>=this.teleportFreezeDuration)if(console.log("Teleport freeze finished. Loading next level."),this.isTeleportingFreeze=!1,this.teleportFreezeTimer=0,this.nextLevelPath){const t=this.nextLevelPath;this.nextLevelPath=null,this._loadLevel(t).then(()=>{console.log("New level loaded successfully after teleport."),this.freezeMovement=!1}).catch(i=>{console.error("Failed to load next level after teleport:",i),this.freezeMovement=!1})}else console.warn("Teleport freeze ended, but no nextLevelPath was set."),this.freezeMovement=!1}_updateDeathAnimationPhase1(e){this.deathAnimationTimer+=e;const t=Math.min(this.deathAnimationTimer/this.deathAnimationDuration,1);this.playerModel.rotation.x=ae.lerp(this.initialDeathXRotation,this.targetDeathXRotation,t);const i=ae.lerp(this.initialDeathPlayerPosition.y,this.targetDeathYPosition,t);if(this.playerModel.position.y=i,this.camera.position.lerpVectors(this.initialCameraPosition,this.targetCameraPositionPhase1,t),this.camera.lookAt(this.playerModel.position),t>=1){console.log("Death Phase 1 complete. Starting Phase 2 (Move to Cenital)."),this.isDyingPhase1=!1,this.isMovingCameraToCenital=!0,this.finalPlayerPosition.copy(this.playerModel.position),this.initialCameraCenitalPosition.copy(this.camera.position),this.initialCameraCenitalQuaternion.copy(this.camera.quaternion),this.targetCameraCenitalPosition.set(this.finalPlayerPosition.x,this.finalPlayerPosition.y+5e3,this.finalPlayerPosition.z);const n=new oe;n.position.copy(this.targetCameraCenitalPosition),n.lookAt(this.finalPlayerPosition),n.updateWorldMatrix(!0,!1),this.targetCameraCenitalQuaternion.copy(n.quaternion),this.cenitalCameraAnimationTimer=0}}_updateCenitalCameraAnimation(e){this.cenitalCameraAnimationTimer+=e;const t=Math.min(this.cenitalCameraAnimationTimer/this.cenitalCameraAnimationDuration,1);this.camera.position.lerpVectors(this.initialCameraCenitalPosition,this.targetCameraCenitalPosition,t),this.camera.quaternion.slerpQuaternions(this.initialCameraCenitalQuaternion,this.targetCameraCenitalQuaternion,t),t>=1&&(console.log("Death Phase 2 complete. Starting Phase 3 (Delay)."),this.isMovingCameraToCenital=!1,this.isWaitingForDeathReload=!0,this.deathDelayTimer=0)}_updateDeathDelay(e){this.deathDelayTimer+=e,this.camera.position.copy(this.targetCameraCenitalPosition),this.camera.quaternion.copy(this.targetCameraCenitalQuaternion),this.deathDelayTimer>=this.deathDelayDuration&&(console.log("Death Phase 3 complete. Game Over."),this.isWaitingForDeathReload=!1,alert("You died :("),window.location.reload())}_handleProximityEvents(){if(this.isDyingPhase1||this.isMovingCameraToCenital||this.isWaitingForDeathReload||this.isPreTeleportLock||this.isTeleportingFreeze)return;if(this.columpioMesh&&this.playerModel&&!this.freezeMovement&&(this.columpioMesh.updateMatrixWorld(!0),this.tempBox.setFromObject(this.columpioMesh,!0),this.playerBox.intersectsBox(this.tempBox))){console.log("Player collided with columpio! Initiating Pre-Teleport Lock."),this.isPreTeleportLock=!0,this.freezeMovement=!0,this.input.resetMovementKeys(),this.preTeleportLockTimer=0,this.nextLevelPath="./models/nivel1.glb";return}let e=!1;const t=1e5;if(this.playerModel&&this.untexturedMeshes.length>0&&!this.freezeMovement){for(const i of this.untexturedMeshes)if(i&&i.geometry){if(i.updateMatrixWorld(!0),this.tempBox.setFromObject(i,!0),this.playerBox.intersectsBox(this.tempBox)){console.log("Player collided with untextured mesh! Triggering death phase 1."),this.isDyingPhase1=!0,this.freezeMovement=!0,this.frozenByUntexturedWarning=!1,this.characterParams.freezeMovement=!0,this.cameraParams.freezeMovement=!0,this.input.resetMovementKeys(),this.initialDeathPlayerPosition.copy(this.playerModel.position),this.initialDeathXRotation=this.playerModel.rotation.x,this.targetDeathXRotation=this.initialDeathXRotation+Math.PI/2,this.targetDeathYPosition=this.initialDeathPlayerPosition.y-1e3,this.deathAnimationTimer=0;return}this.tempBox.distanceToPoint(this.playerModel.position)<t&&(e=!0,this.untexturedWarningShown||(console.log("Near untextured, freezing movement for warning."),this.freezeMovement=!0,this.frozenByUntexturedWarning=!0,this.characterParams.freezeMovement=!0,this.cameraParams.freezeMovement=!0,alert("WARNING! Getting closer..."),console.log("Alert dismissed, unfreezing movement and resetting input."),this.freezeMovement=!1,this.frozenByUntexturedWarning=!1,this.untexturedWarningShown=!0,this.input.resetMovementKeys()))}}if(!e&&this.untexturedWarningShown&&!this.frozenByUntexturedWarning&&!this.isDyingPhase1&&!this.isPreTeleportLock&&!this.isTeleportingFreeze&&(console.log("Away from all untextured meshes (for warning), resetting shown flag."),this.untexturedWarningShown=!1),this.chestModel&&this.playerModel&&!this.freezeMovement&&this.playerModel.position.distanceTo(this.chestModel.position)<1e3&&(console.log("Near chest, freezing movement."),this.freezeMovement=!0,this.frozenByUntexturedWarning=!1,this.characterParams.freezeMovement=!0,this.cameraParams.freezeMovement=!0,this.chestMessage.style.display="block",this.coordDisplay.style.display="none"),this.freezeMovement&&!this.frozenByUntexturedWarning&&!this.isPreTeleportLock&&!this.isTeleportingFreeze&&!this.isDyingPhase1&&this.input.keys.quit&&this.chestMessage.style.display==="block"){console.log("Leaving chest, unfreezing movement."),this.freezeMovement=!1,this.untexturedWarningShown=!1,this.chestMessage.style.display="none";const i=new A;this.camera.getWorldDirection(i);const s=i.multiplyScalar(-100);this.playerModel.position.add(s),this.coordDisplay.style.display="block"}this.cube010Mesh&&this.playerModel&&this.playerModel.position.distanceTo(this.cube010Mesh.position)}_updateCoordinateDisplay(e){var s;if(!this.coordDisplay||!this.playerModel)return;const t=this.playerModel.position.clone().sub(this.coordinateOffset),i=e.currentCollisionMesh?e.currentCollisionMesh.name||"Unnamed Mesh":"None";this.coordDisplay.textContent=`X: ${t.x.toFixed(1)}  Y: ${t.y.toFixed(1)}  Z: ${t.z.toFixed(1)} 
VelY: ${((s=this.character.velocityY)==null?void 0:s.toFixed(1))||"0.0"}  Grounded: ${e.isGrounded?"YES":"NO"} 
Colliding with: ${i}`}_onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.instance.setSize(window.innerWidth,window.innerHeight)}_createCoordinateDisplay(){const e=document.createElement("div");return e.style.cssText=`
      position: fixed;
      bottom: 20px;
      left: 20px;
      color: white;
      font-family: monospace;
      background: rgba(0,0,0,0.7);
      padding: 8px;
      border-radius: 4px;
      z-index: 1000;
    `,document.body.appendChild(e),e}_createChestMessage(){const e=document.createElement("div");return e.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: Arial, sans-serif;
      font-size: 2em;
      text-align: center;
      background: rgba(0,0,0,0.8);
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 1001;
    `,e.textContent="Wow! A chest! I wonder what's inside",document.body.appendChild(e),e}_updateChestPhysics(e){if(!this.chestModel||!this.collisionMeshes||this.collisionMeshes.length===0)return;this.chestModel.updateMatrixWorld(!0);const t=this._getGroundHeightBelowChest(this.chestModel.position);if(t!==-1/0){const i=t+this.chestHoverHeight;Math.abs(this.chestModel.position.y-i)<5||this.chestModel.position.y>i&&this.chestVelocityY<=0?(this.isChestGrounded||(this.chestModel.position.y=i),this.chestVelocityY=0,this.isChestGrounded=!0):this.isChestGrounded=!1}else this.isChestGrounded=!1;if(!this.isChestGrounded){this.chestVelocityY+=this.chestGravity*e,this.chestVelocityY=Math.max(this.chestVelocityY,-2e4);const i=this.chestVelocityY*e;this.chestModel.position.y+=i,this.chestModel.position.y<-3e4&&(console.warn("Chest fell too far, resetting position near player."),this.chestModel.position.copy(this.playerModel.position).add(new A(2e3,500,0)),this.chestVelocityY=0)}this._updateStarAndLightPosition()}_getGroundHeightBelowChest(e){const t=e.clone();if(t.y+=10,this.chestRaycaster.set(t,new A(0,-1,0)),this.chestRaycaster.far=e.y+31e3,!this.collisionMeshes||this.collisionMeshes.length===0)return-1/0;const i=this.collisionMeshes.filter(n=>n!==this.chestModel),s=this.chestRaycaster.intersectObjects(i,!0);if(s.length>0){let n=-1/0;for(const r of s)r.point.y<t.y&&r.point.y>n&&(n=r.point.y);return n}else return-1/0}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded event fired.");const u=document.getElementById("startGameButton"),e=document.getElementById("startMutedButton"),t=document.getElementById("game-buttons");if(console.log("startButton found:",u),console.log("mutedButton found:",e),console.log("buttonsContainer found:",t),u&&e&&t){let i=function(s=!1){console.log(`startGame called with muted = ${s}`),t&&(console.log("Hiding buttons container."),t.style.display="none"),console.log("Creating new Game instance..."),new vi(s),console.log("New Game instance created.")};console.log("Buttons and container found, attaching listeners."),u.addEventListener("click",()=>{console.log("Start Game button clicked!"),i(!1)}),e.addEventListener("click",()=>{console.log("Start Muted button clicked!"),i(!0)}),console.log("Event listeners attached.")}else console.warn("One or more start elements (buttons or container) not found!")});
